!function(){function e(){var e,t,n=1;for(n;$.lang.exists("adventuresystem.stories."+n+".title");n++){for(t=[],e=1;$.lang.exists("adventuresystem.stories."+n+".chapter."+e);e++)t.push($.lang.get("adventuresystem.stories."+n+".chapter."+e));P.push({title:$.lang.get("adventuresystem.stories."+n+".title"),lines:t})}$.consoleDebug($.lang.get("adventuresystem.loaded",n-1))}function t(){var e,t=$.inidb.GetKeyList("adventurePayouts",""),n=[],s=1,i=[];0==t.length&&$.say($.lang.get("adventuresystem.top5.empty"));for(e in t)t[e].equalsIgnoreCase($.ownerName)||t[e].equalsIgnoreCase($.botName)||n.push({username:t[e],amount:parseInt($.inidb.get("adventurePayouts",t[e]))});n.sort(function(e,t){return e.amount<t.amount?1:-1});for(e in n)5>=s&&(i.push(s+". "+n[e].username+": "+$.getPointsString(n[e].amount)),s++);$.say($.lang.get("adventuresystem.top5",i.join(", ")))}function n(e){var t;for(t in S.users)if(S.users[t].username==e)return!0;return!1}function s(e){var t,n=[];for(t in e)n.push($.username.resolve(e[t].username));return n.join(", ")}function i(){var e;for(e in S.users)$.randRange(0,20)>5?S.survivors.push(S.users[e]):S.caught.push(S.users[e])}function r(e){return e.indexOf("(caught)")>-1?S.caught.length>0?e.replace("(caught)",s(S.caught)):"":e.indexOf("(survivors)")>-1?S.survivors.length>0?e.replace("(survivors)",s(S.survivors)):"":e}function a(e,t){if($.bot.isModuleEnabled("./games/tamagotchi.js")){var n=$.tamagotchi.getByOwner(e);n&&(n.isHappy()?(n.incrFunLevel(f).incrExpLevel(b).decrFoodLevel(h).save(),$.say($.lang.get("adventuresystem.tamagotchijoined",n.name)),S.users.push({username:n.name,tgOwner:e,bet:t/2})):n.sayFunLevel())}}function o(e){S.gameState=1;var t=setTimeout(function(){g(),clearTimeout(t)},1e3*m);$.say($.lang.get("adventuresystem.start.success",$.resolveRank(e),$.pointNameMultiple))}function u(e,t){return S.gameState>1?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.notpossible")):n(e)?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.alreadyjoined")):t>$.getUserPoints(e)?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.needpoints",$.getPointsString(t),$.getPointsString($.getUserPoints(e)))):y>t?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.bettoolow",$.getPointsString(t),$.getPointsString(y))):t>p?void $.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.bettoohigh",$.getPointsString(t),$.getPointsString(p))):(S.users.push({username:e,bet:parseInt(t)}),$.inidb.decr("points",e,t),a(e,t),0==S.gameState?o(e):$.say($.whisperPrefix(e)+$.lang.get("adventuresystem.join.success",$.getPointsString(t))),!0)}function g(){var e,t,n=0,s=$.randElement(P);S.gameState=2,i(),$.say($.lang.get("adventuresystem.runstory",s.title,S.users.length)),t=setInterval(function(){n<s.lines.length?(e=r(s.lines[n]),""!=e&&$.say(e)):(d(),clearInterval(t)),n++},5e3)}function d(){var e,t;for(e in S.survivors)S.survivors[e].tgOwner&&(S.survivors[e].username=S.survivors[e].tgOwner),t=S.survivors[e].bet*(c/100),$.inidb.incr("adventurePayouts",S.survivors[e].username,t),$.inidb.incr("points",S.survivors[e].username,S.survivors[e].bet+t);$.say($.lang.get("adventuresystem.completed",S.survivors.length,S.caught.length)),v(),$.coolDown.set("adventure",1e3*l)}function v(){S={gameState:0,users:[],tgOwners:[],survivors:[],caught:[]}}var m=$.inidb.exists("adventureSettings","joinTime")?parseInt($.inidb.get("adventureSettings","joinTime")):60,l=$.inidb.exists("adventureSettings","coolDown")?parseInt($.inidb.get("adventureSettings","coolDown")):900,c=$.inidb.exists("adventureSettings","gainPercent")?parseInt($.inidb.get("adventureSettings","gainPercent")):30,y=$.inidb.exists("adventureSettings","minBet")?parseInt($.inidb.get("adventureSettings","minBet")):10,p=$.inidb.exists("adventureSettings","maxBet")?parseInt($.inidb.get("adventureSettings","maxBet")):1e3,f=1,b=.5,h=.25,S=1,P=[],x=!1;$.bind("command",function(e){var n=e.getSender().toLowerCase(),s=e.getCommand(),i=e.getArgs(),r=i[0],a=i[1],o=parseInt(i[2]);if(s.equalsIgnoreCase("adventure")){if(!r)return void $.say($.whisperPrefix(n)+$.lang.get("adventuresystem.adventure.usage",$.pointNameMultiple));if(!isNaN(parseInt(r)))return void u(n,parseInt(r));if(r.equalsIgnoreCase("top5")&&t(),r.equalsIgnoreCase("set")){if(!$.isAdmin(n))return void $.say($.whisperPrefix(n)+$.adminMsg);if(!a||isNaN(o))return void $.say($.whisperPrefix(n)+$.lang.get("adventuresystem.set.usage"));a.equalsIgnoreCase("joinTime")&&(m=o,$.inidb.set("adventureSettings","joinTime",o)),a.equalsIgnoreCase("coolDown")&&(l=o,$.inidb.set("adventureSettings","coolDown",o)),a.equalsIgnoreCase("gainPercent")&&(c=o,$.inidb.set("adventureSettings","gainPercent",o)),a.equalsIgnoreCase("minBet")&&(y=o,$.inidb.set("adventureSettings","minBet",o)),a.equalsIgnoreCase("maxBet")&&(p=o,$.inidb.set("adventureSettings","maxBet",o)),$.say($.whisperPrefix(n)+$.lang.get("adventuresystem.set.success",a,o))}}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./games/adventureSystem.js")&&(v(),x||(e(),x=!0),$.registerChatCommand("./games/adventureSystem.js","adventure",7))}),$.bot.isModuleEnabled("./games/adventureSystem.js")&&!$.bot.isModuleEnabled("./systems/pointSystem.js")&&$.logError("adventureSystem.js",402,"Disabled. ./systems/pointSystem.js is not enabled.")}();
