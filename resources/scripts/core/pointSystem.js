(function(){var e=$.getIniDbBoolean("pointSettings","pointsTimedGain")?$.getIniDbBoolean("pointSettings","pointsTimedGain"):true,i=$.inidb.exists("pointSettings","onlineGain")?parseInt($.inidb.get("pointSettings","onlineGain")):1,t=$.inidb.exists("pointSettings","offlineGain")?parseInt($.inidb.get("pointSettings","offlineGain")):1,n=$.inidb.exists("pointSettings","onlinePayoutInterval")?parseInt($.inidb.get("pointSettings","onlinePayoutInterval")):10,s=$.inidb.exists("pointSettings","offlinePayoutInterval")?parseInt($.inidb.get("pointSettings","offlinePayoutInterval")):0,r=$.getIniDbBoolean("pointSettings","modPointsPermToggle")?$.getIniDbBoolean("pointSettings","modPointsPermToggle"):false,a=0,o=$.inidb.exists("pointSettings","pointNameSingle")?$.inidb.get("pointSettings","pointNameSingle"):"Point",g=$.inidb.exists("pointSettings","pointNameMultiple")?$.inidb.get("pointSettings","pointNameMultiple"):"Points";function p(e){if($.inidb.exists("points",e)){return parseInt($.inidb.get("points",e))}else{return 0}}function l(e){if(parseInt(e)==1){return e+" "+o}return e+" "+g}function m(e){if(r){if(!$.isModv3(e.getSender().toLowerCase(),e.getTags())){$.say($.whisperPrefix(e.getSender().toLowerCase())+$.modMsg);return false}}else if(!$.isAdmin(e.getSender().toLowerCase())){$.say($.whisperPrefix(e.getSender().toLowerCase())+$.adminMsg);return false}return true}function u(e){if(e&&$.commandExists(e)){$.unregisterChatCommand(e)}if(!$.commandExists(o)&&!e){$.registerChatCommand("./core/pointSystem.js",$.pointNameSingle,7)}if(!$.commandExists(g)&&!e){$.registerChatCommand("./core/pointSystem.js",$.pointNameMultiple,7)}}function f(){var e=$.systemTime(),r=[],o,g,p;if(!$.bot.isModuleEnabled("./core/pointSystem.js")){return}if($.isOnline($.channelName)){if(n>0&&a+n*6e4<=e){g=i}else{return}}else{if(s>0&&a+s*6e4<=e){g=t}else{return}}for(p in $.users){o=$.users[p][0].toLowerCase();$.inidb.incr("points",o,g);r.push(o)}$.log("pointSystem","Executed "+$.pointNameMultiple+" payouts. Amount: "+g+". Users: "+(r.length>0?r.join(", "):"none"));a=e}$.bind("command",function(e){var a=e.getSender().toLowerCase(),o=$.username.resolve(a,e.getTags()),g=e.getCommand(),f=e.getArgs(),y=f[0],d=f[1],P=f[2],S,N;if(g.equalsIgnoreCase("points")||g.equalsIgnoreCase($.pointNameMultiple)||g.equalsIgnoreCase($.pointNameSingle)){if(!y){if($.getUserPoints(a)==0){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.get.self.nopoints",$.pointNameMultiple))}else{$.say($.whisperPrefix(a)+$.lang.get("pointsystem.get.self.withtime",$.resolveRank(a),$.getPointsString($.getUserPoints(a)),$.getUserTimeString(a)))}}else{if(!m(e)){return}if(y.equalsIgnoreCase("add")){d=(d+"").toLowerCase();P=parseInt(P);if(isNaN(P)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.add.usage"));return}if(!d||!$.user.isKnown(d)){$.say($.whisperPrefix(a)+$.lang.get("common.user.404",d));return}if(P<0){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.add.error.negative",$.pointNameMultiple));return}if($.user.isKnown(d)){$.inidb.incr("points",d,P);$.say($.lang.get("pointsystem.add.success",$.getPointsString(P),$.username.resolve(d),$.getPointsString($.getUserPoints(d))))}}if(y.equalsIgnoreCase("take")){d=(d+"").toLowerCase();P=parseInt(P);if(isNaN(P)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.take.usage"));return}if(!d||!$.user.isKnown(d)){$.say($.whisperPrefix(a)+$.lang.get("common.user.404",d));return}if(P>$.getUserPoints(d)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.take.error.toomuch",o,$.pointNameMultiple));return}$.inidb.decr("points",d,P);$.say($.lang.get("pointsystem.take.success",$.getPointsString(P),$.username.resolve(d),$.getPointsString($.getUserPoints(d))))}if(y.equalsIgnoreCase("set")){d=(d+"").toLowerCase();P=parseInt(P);if(isNaN(P)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.setbalance.usage"));return}if(!d||!$.user.isKnown(d)){$.say($.whisperPrefix(a)+$.lang.get("common.user.404",d));return}if(P<0){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.setbalance.error.negative",$.pointNameMultiple));return}$.inidb.set("points",d,P);$.say($.lang.get("pointsystem.setbalance.success",$.pointNameSingle,$.username.resolve(d),$.getPointsString($.getUserPoints(d))))}if(y.equalsIgnoreCase("all")){if(!d){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.add.all.usage"));return}d=parseInt(d);if(d<0){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.add.error.negative",$.pointNameMultiple));return}for(N in $.users){$.inidb.incr("points",$.users[N][0].toLowerCase(),d)}$.say($.lang.get("pointsystem.add.all.success",$.getPointsString(d)))}if(y.equalsIgnoreCase("setname")){d+"";P+"";if(d=="single"&&P){S=$.pointNameSingle;$.pointNameSingle=P;$.inidb.set("pointSettings","pointNameSingle",$.pointNameSingle);u(S);u();$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.name.single.success",S,$.pointNameSingle));return}if(d=="multiple"&&P){S=$.pointNameMultiple;$.pointNameMultiple=P;$.inidb.set("pointSettings","pointNameMultiple",$.pointNameMultiple);u(S);u();$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.name.multiple.success",S,$.pointNameMultiple));return}if(!P){S=$.pointNameMultiple;$.pointNameMultiple=$.pointNameSingle=P;$.inidb.set("pointSettings","pointNameSingle",$.pointNameSingle);$.inidb.set("pointSettings","pointNameMultiple",$.pointNameSingle);u(S);$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.name.both.success",S,$.pointNameMultiple));return}$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.name.usage"))}if(y.equalsIgnoreCase("setgain")){d=parseInt(d);if(isNaN(d)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.gain.usage"));return}if(d<0){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.gain.error.negative",$.pointNameMultiple));return}i=d;$.inidb.set("pointSettings","onlineGain",i);$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.gain.success",$.pointNameSingle,$.getPointsString(i),n))}if(y.equalsIgnoreCase("setofflinegain")){d=parseInt(d);if(isNaN(d)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.gain.offline.usage"));return}if(d<0){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.gain.error.negative",$.pointNameMultiple));return}t=d;$.inidb.set("pointSettings","offlineGain",t);$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.gain.offline.success",$.pointNameSingle,$.getPointsString(t),s))}if(y.equalsIgnoreCase("setinterval")){d=parseInt(d);if(isNaN(d)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.interval.usage"));return}if(d<0){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.interval.error.negative",$.pointNameMultiple));return}n=d;$.inidb.set("pointSettings","onlinePayoutInterval",n);$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.interval.success",$.pointNameSingle,n))}if(y.equalsIgnoreCase("setofflineinterval")){d=parseInt(d);if(isNaN(d)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.interval.offline.usage"));return}if(d<0){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.interval.error.negative",$.pointNameMultiple));return}s=d;$.inidb.set("pointSettings","offlinePayoutInterval",s);$.say($.whisperPrefix(a)+$.lang.get("pointsystem.set.interval.offline.success",$.pointNameSingle,s))}if(y.equalsIgnoreCase("modpermtoggle")){r=!r;$.setIniDbBoolean("pointSettings","modPointsPermToggle",r);$.say($.whisperPrefix(a)+$.lang.get("pointsystem.modpermtoggle.success",r?"moderator":"administrator"))}}}if(g.equalsIgnoreCase("makeitrain")){if(!$.isAdmin(a)){$.say($.whisperPrefix(a)+$.adminMsg);return}y=parseInt(y);if(isNaN(y)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.makeitrain.usage"));return}if(y<1){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.makeitrain.error.negative",$.pointNameMultiple));return}for(N in $.users){var c=$.randRange(1,y);S=[];$.inidb.incr("points",$.users[N][0].toLowerCase(),c);if(!$.users[N][0].equalsIgnoreCase($.botName)){S.push($.username.resolve($.users[N][0])+": "+$.getPointsString(c))}}if(S.length>0){$.say($.lang.get("pointsystem.makeitrain.success",o,$.pointNameMultiple,S.join(", ")))}}if(g.equalsIgnoreCase("gift")){if(!f[0]||!f[1]){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.gift.usage"));return}if(parseInt(f[1])>p(a)){$.say($.whisperPrefix(a)+$.lang.get("pointsystem.err.not.points"));return}$.inidb.incr("points",f[0].toLowerCase(),parseInt(f[1]));$.inidb.decr("points",a,parseInt(f[1]));$.say($.lang.get("pointsystem.gifted",$.username.resolve(a),l(parseInt(f[1])),$.username.resolve(f[0])))}});setInterval(function(){f()},6e4);$.bind("initReady",function(){if($.bot.isModuleEnabled("./core/pointSystem.js")){$.registerChatCommand("./core/pointSystem.js","makeitrain",2);$.registerChatCommand("./core/pointSystem.js","points",7);u()}});$.pointNameSingle=o;$.pointNameMultiple=g;$.getUserPoints=p;$.getPointsString=l})();
