!function(){function e(e){return $.inidb.exists("points",e)?parseInt($.inidb.get("points",e)):0}function s(e){return 1==parseInt(e)?e+" "+p:e+" "+u}function t(e){e&&$.commandExists(e.toLowerCase())&&"points"!=e.toLowerCase()&&"point"!=e.toLowerCase()&&$.unregisterChatCommand(e.toLowerCase()),$.commandExists(p.toLowerCase())||e||($.registerChatCommand("./systems/pointSystem.js",p.toLowerCase(),7),$.registerChatSubcommand(p.toLowerCase(),"add",1),$.registerChatSubcommand(p.toLowerCase(),"take",1),$.registerChatSubcommand(p.toLowerCase(),"set",1),$.registerChatSubcommand(p.toLowerCase(),"all",1),$.registerChatSubcommand(p.toLowerCase(),"setname",1),$.registerChatSubcommand(p.toLowerCase(),"setgain",1),$.registerChatSubcommand(p.toLowerCase(),"setofflinegain",1),$.registerChatSubcommand(p.toLowerCase(),"setinterval",1),$.registerChatSubcommand(p.toLowerCase(),"user",7),$.registerChatSubcommand(p.toLowerCase(),"check",7)),$.commandExists(u.toLowerCase())||e||($.registerChatCommand("./systems/pointSystem.js",u.toLowerCase(),7),$.registerChatSubcommand(u.toLowerCase(),"add",1),$.registerChatSubcommand(u.toLowerCase(),"take",1),$.registerChatSubcommand(u.toLowerCase(),"set",1),$.registerChatSubcommand(u.toLowerCase(),"all",1),$.registerChatSubcommand(u.toLowerCase(),"setname",1),$.registerChatSubcommand(u.toLowerCase(),"setgain",1),$.registerChatSubcommand(u.toLowerCase(),"setofflinegain",1),$.registerChatSubcommand(u.toLowerCase(),"setinterval",1),$.registerChatSubcommand(u.toLowerCase(),"user",7),$.registerChatSubcommand(p.toLowerCase(),"check",7))}function i(){var e,s,t,i=$.systemTime(),g=[];if($.bot.isModuleEnabled("./systems/pointSystem.js")){if($.isOnline($.channelName)){if(!(a>0&&i>=m+6e4*a))return;s=n}else{if(!(o>0&&i>=m+6e4*o))return;s=r}for(t in $.users)e=$.users[t][0].toLowerCase(),$.isOnline($.channelName)?$.inidb.exists("grouppoints",$.getUserGroupName(e))&&(s=parseInt($.inidb.get("grouppoints",$.getUserGroupName(e)))<0?n:parseInt($.inidb.get("grouppoints",$.getUserGroupName(e)))):$.inidb.exists("grouppointsoffline",$.getUserGroupName(e))&&(s=parseInt($.inidb.get("grouppointsoffline",$.getUserGroupName(e)))<0?r:parseInt($.inidb.get("grouppointsoffline",$.getUserGroupName(e)))),$.bot.isModuleEnabled("./handlers/gameWispHandler.js")&&0!=$.getTierData(e,"bonuspoints")&&(s+=Math.floor(s*($.getTierData(e,"bonuspoints")/100))),$.inidb.incr("points",e,s),g.push(e+"("+s+")");$.log("pointSystem","Executed "+u+" payouts. Users: "+(g.length>0?g.join(", "):"none")),m=i}}var n=($.getSetIniDbBoolean("pointSettings","pointsTimedGain",!0),$.getSetIniDbNumber("pointSettings","onlineGain",1)),r=$.getSetIniDbNumber("pointSettings","offlineGain",1),a=$.getSetIniDbNumber("pointSettings","onlinePayoutInterval",10),o=$.getSetIniDbNumber("pointSettings","offlinePayoutInterval",0),g=$.getSetIniDbBoolean("pointSettings","modPointsPermToggle",!1),m=0,p=$.getSetIniDbString("pointSettings","pointNameSingle","point"),u=$.getSetIniDbString("pointSettings","pointNameMultiple","points");$.bind("command",function(i){var m,l,d,f=i.getSender().toLowerCase(),y=$.username.resolve(f,i.getTags()),C=i.getCommand(),c=i.getArgs(),h=c[0],w=c[1],S=c[2];if(C.equalsIgnoreCase("points")||C.equalsIgnoreCase("point")||C.equalsIgnoreCase(u)||C.equalsIgnoreCase(p))if(h)if(h.equalsIgnoreCase("user")||h.equalsIgnoreCase("check")){if(!w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.user.usage"));if(l=(w+"").toLowerCase(),!$.user.isKnown(l))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",l));$.say($.whisperPrefix(f)+$.lang.get("pointsystem.user.success",$.resolveRank(l),$.getPointsString($.getUserPoints(l))))}else if(h.equalsIgnoreCase("add")){if(w=(w+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(0>S)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.error.negative",u));$.user.isKnown(w)&&($.inidb.incr("points",w,S),$.say($.lang.get("pointsystem.add.success",$.getPointsString(S),$.username.resolve(w),$.getPointsString($.getUserPoints(w)))))}else if(h.equalsIgnoreCase("take")){if(w=(w+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.take.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(S>$.getUserPoints(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.take.error.toomuch",y,u));$.inidb.decr("points",w,S),$.say($.lang.get("pointsystem.take.success",$.getPointsString(S),$.username.resolve(w),$.getPointsString($.getUserPoints(w))))}else if(h.equalsIgnoreCase("set")){if(w=(w+"").toLowerCase(),S=parseInt(S),isNaN(S))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.setbalance.usage"));if(!w||!$.user.isKnown(w))return void $.say($.whisperPrefix(f)+$.lang.get("common.user.404",w));if(0>S)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.setbalance.error.negative",u));$.inidb.set("points",w,S),$.say($.lang.get("pointsystem.setbalance.success",p,$.username.resolve(w),$.getPointsString($.getUserPoints(w))))}else if(h.equalsIgnoreCase("all")){if(!w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.all.usage"));if(w=parseInt(w),0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.add.error.negative",u));for(d in $.users)$.inidb.incr("points",$.users[d][0].toLowerCase(),w);$.say($.lang.get("pointsystem.add.all.success",$.getPointsString(w)))}else if(h.equalsIgnoreCase("setname")){if(w.equalsIgnoreCase("single")&&S)return m=p,p=S,$.inidb.set("pointSettings","pointNameSingle",p),t(m),t(),void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.single.success",m,p));if(w.equalsIgnoreCase("multiple")&&S)return m=u,u=S,$.inidb.set("pointSettings","pointNameMultiple",u),t(m),t(),void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.multiple.success",m,u));if(w.equalsIgnoreCase("delete"))return $.inidb.del("pointSettings","pointNameSingle"),$.inidb.del("pointSettings","pointNameMultiple"),t(p),t(u),p="point",u="points",void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.delete"));$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.name.usage"))}else if(h.equalsIgnoreCase("setgain")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.error.negative",u));n=w,$.inidb.set("pointSettings","onlineGain",n),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.success",p,$.getPointsString(n),a))}else if(h.equalsIgnoreCase("setofflinegain")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.offline.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.error.negative",u));r=w,$.inidb.set("pointSettings","offlineGain",r),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.gain.offline.success",p,$.getPointsString(r),o))}else if(h.equalsIgnoreCase("setinterval")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.error.negative",u));a=w,$.inidb.set("pointSettings","onlinePayoutInterval",a),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.success",p,a))}else if(h.equalsIgnoreCase("setofflineinterval")){if(w=parseInt(w),isNaN(w))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.offline.usage"));if(0>w)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.error.negative",u));o=w,$.inidb.set("pointSettings","offlinePayoutInterval",o),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.set.interval.offline.success",p,o))}else h.equalsIgnoreCase("modpermtoggle")?(g=!g,$.setIniDbBoolean("pointSettings","modPointsPermToggle",g),$.say($.whisperPrefix(f)+$.lang.get("pointsystem.modpermtoggle.success",g?"moderator":"administrator"))):$.say($.whisperPrefix(f)+$.lang.get("pointsystem.usage.invalid","!"+C));else 0==$.getUserPoints(f)?$.say($.whisperPrefix(f)+$.lang.get("pointsystem.get.self.nopoints",u)):$.say($.whisperPrefix(f)+$.lang.get("pointsystem.get.self.withtime",$.hasRank(f)?"the "+$.getRank(f):"",$.getPointsString($.getUserPoints(f)),$.getUserTimeString(f)));if(C.equalsIgnoreCase("makeitrain")){if(!$.isAdmin(f))return void $.say($.whisperPrefix(f)+$.adminMsg);if(h=parseInt(h),isNaN(h))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.makeitrain.usage"));if(1>h)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.makeitrain.error.negative",u));for(d in $.users){var b=$.randRange(1,h);m=[],$.inidb.incr("points",$.users[d][0].toLowerCase(),b),$.users[d][0].equalsIgnoreCase($.botName)||m.push($.username.resolve($.users[d][0])+": "+$.getPointsString(b))}m.length>0&&$.say($.lang.get("pointsystem.makeitrain.success",y,u,m.join(", ")))}if(C.equalsIgnoreCase("gift")){if(!c[0]||!c[1])return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.usage"));if(parseInt(c[1])>e(f))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.shortpoints"));if(!$.user.isKnown(c[0].toLowerCase()))return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.gift.404"));if(parseInt(c[1])<=0)return void $.say($.whisperPrefix(f)+$.lang.get("pointsystem.err.negative",u));$.inidb.incr("points",c[0].toLowerCase(),parseInt(c[1])),$.inidb.decr("points",f,parseInt(c[1])),$.say($.lang.get("pointsystem.gift.success",$.username.resolve(f),s(parseInt(c[1])),$.username.resolve(c[0])))}}),setInterval(function(){i()},6e4),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/pointSystem.js")&&($.registerChatCommand("./systems/pointSystem.js","makeitrain",2),$.registerChatCommand("./systems/pointSystem.js","points",7),$.registerChatCommand("./systems/pointSystem.js","point",7),$.registerChatCommand("./systems/pointSystem.js","gift",7),$.registerChatSubcommand("points","add",1),$.registerChatSubcommand("points","take",1),$.registerChatSubcommand("points","set",1),$.registerChatSubcommand("points","all",1),$.registerChatSubcommand("points","setname",1),$.registerChatSubcommand("points","setgain",1),$.registerChatSubcommand("points","setofflinegain",1),$.registerChatSubcommand("points","setinterval",1),$.registerChatSubcommand("points","user",7),$.registerChatSubcommand("points","check",7),t())}),$.pointNameSingle=p,$.pointNameMultiple=u,$.getUserPoints=e,$.getPointsString=s}();
