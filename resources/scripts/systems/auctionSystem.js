(function(){var t={increments:0,minimum:0,topUser:0,topPoints:0,timer:0,status:false};function e(e,i,r,a){if(t.status){$.say($.whisperPrefix(e)+$.lang.get("auctionsystem.err.opened"));return}if(!i||!r){$.say($.whisperPrefix(e)+$.lang.get("auctionsystem.usage"));return}if(i){t.increments=parseInt(i)}if(r){t.minimum=parseInt(r)}if(a){t.timer=parseInt(a)}t.status=true;$.say($.lang.get("auctionsystem.opened",$.getPointsString(i),$.getPointsString(r)));if(a>0){$.say($.lang.get("auctionsystem.auto.timer.msg",a));var o=setInterval(function(){n(true);clearInterval(o)},a/2*1e3);var g=setInterval(function(){s();clearInterval(g)},a*1e3)}}function s(e){if(!t.status){$.say($.whisperPrefix(e)+$.lang.get("auctionsystem.err.closed"));return}if(!t.topUser){t.status=false;$.say($.lang.get("auctionsystem.err.no.bids"));return}t.status=false;$.inidb.decr("points",t.topUser,t.topPoints);$.say($.lang.get("auctionsystem.closed",t.topUser,$.getPointsString(t.topPoints)))}function n(e){if(!t.status){$.say($.whisperPrefix(user)+$.lang.get("auctionsystem.err.closed"));return}if(e){$.say($.lang.get("auctionsystem.warn.force",t.topUser,$.getPointsString(t.topPoints),$.getPointsString(t.topPoints+t.increments)))}else{$.say($.lang.get("auctionsystem.warn",t.topUser,$.getPointsString(t.topPoints)))}}function i(e,s){if(!t.status){$.say($.whisperPrefix(e)+$.lang.get("auctionsystem.err.closed"));return}if(!s){$.say($.whisperPrefix(e)+$.lang.get("auctionsystem.bid.usage"));return}else if(s<t.minimum){$.say($.lang.get("auctionsystem.err.bid.minimum",$.getPointsString(t.topPoints)));return}else if(s>$.getUserPoints(e)){$.say($.whisperPrefix(e)+$.lang.get("auctionsystem.err.points",$.pointNameMultiple));return}else if(s<t.topPoints+t.increments){$.say($.lang.get("auctionsystem.err.increments",$.getPointsString(t.increments)));return}t.topUser=e;t.topPoints=parseInt(s);$.say($.lang.get("auctionsystem.bid",e,$.getPointsString(s),$.getPointsString(t.topPoints+t.increments)))}$.bind("command",function(t){var r=t.getSender(),a=t.getCommand(),o=t.getArgs(),g=o[0];if(a.equalsIgnoreCase("auction")){if(!$.isModv3(r,t.getTags())){$.say($.getWhisperString(r)+$.modMsg);return}if(!g){$.say($.whisperPrefix(r)+$.lang.get("auctionsystem.usage"));return}if(g.equalsIgnoreCase("open")){e(r,o[1],o[2],o[3])}if(g.equalsIgnoreCase("close")){s(r)}if(g.equalsIgnoreCase("warn")){n()}}if(a.equalsIgnoreCase("bid")){i(r,g)}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./systems/auctionSystem.js")){$.registerChatCommand("./systems/auctionSystem.js","auction",2);$.registerChatCommand("./systems/auctionSystem.js","bid",7)}})})();
