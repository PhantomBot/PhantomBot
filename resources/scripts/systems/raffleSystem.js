(function(){var e=0,s=[],r="",a=false,f=false,t=$.inidb.exists("settings","raffleMSGToggle")?$.getIniDbBoolean("settings","raffleMSGToggle"):false,n=0,l="";function i(s,t,i,o,m){if(f){$.say($.whisperPrefix(s)+$.lang.get("rafflesystem.err.raffle.opened"));return}if(!t||!i){$.say($.whisperPrefix(s)+$.lang.get("rafflesystem.err.missing.syntax"));return}if(t.contains("!")){t=t.replace("!","")}if(t){r=t}if(i){e=parseInt(i)}if(o&&o.equalsIgnoreCase("-followers")){a=true;l=$.lang.get("rafflesystem.msg.need.to.be.follwing")}if(m){n=parseInt(m)}g(t,a,e,n)}function g(e,r,a,t){$.say($.lang.get("rafflesystem.raffle.opened",$.getPointsString(a),e,n));$.registerChatCommand("./systems/raffleSystem.js",e,7);s=[];f=true;if(t>0){var n=setInterval(function(){$.say($.lang.get("rafflesystem.warn",e));clearInterval(n)},t/2*1e3);var l=setInterval(function(){o();clearInterval(l)},t*1e3)}}function o(s){if(!f){$.say($.whisperPrefix(s)+$.lang.get("rafflesystem.err.raffle.not.opened"));return}f=false;a=false;r="";e=0;l="";$.say($.lang.get("rafflesystem.raffle.closed"));m()}function m(e){if(s.length==0){$.say($.lang.get("rafflesystem.raffle.close.err"));return}if(e){$.say($.lang.get("rafflesystem.raffle.repick",$.username.resolve($.randElement(s))));return}m=$.randElement(s);$.say($.lang.get("rafflesystem.winner",$.username.resolve(m)))}function y(e,r){if(!f){$.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.raffle.not.opened"));return}if(a){if(!$.user.isFollower(e)){$.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.not.following"));return}}if($.list.contains(s,e)){$.say($.whisperPrefix(e)+$.lang.get("rafflesystem.enter.error.alreadyentered"));return}if(r>0){$.inidb.decr("points",e,r);if(r>$.getUserPoints(e)){$.say($.whisperPrefix(e)+$.lang.get("rafflesystem.err.points",$.pointNameMultiple));return}}if(t){$.say($.lang.get("rafflesystem.entered",$.username.resolve(e)))}s.push(e)}$.bind("command",function(s){var a=s.getSender(),f=s.getCommand(),n=s.getArguments(),l=s.getArgs(),g=l[0];if(f.equalsIgnoreCase("raffle")){if(!$.isModv3(a,s.getTags())){$.say($.whisperPrefix(a)+$.modMsg);return}if(!g){$.say($.whisperPrefix(a)+$.lang.get("rafflesystem.usage"));return}if(g.equalsIgnoreCase("open")){i(a,l[1],l[2],l[3])}if(g.equalsIgnoreCase("close")){o(a)}if(g.equalsIgnoreCase("repick")){m(true)}if(g.equalsIgnoreCase("messagetoggle")){if(t){t=false;$.inidb.set("settings","raffleMSGToggle",t);$.say($.whisperPrefix(a)+$.lang.get("rafflesystem.msg.disabled"))}else{t=true;$.inidb.set("settings","raffleMSGToggle",t);$.say($.whisperPrefix(a)+$.lang.get("rafflesystem.msg.enabled"))}}}if(f.equalsIgnoreCase(r)){y(a,e)}});$.bind("initReady",function(){if($.bot.isModuleEnabled("./systems/raffleSystem.js")){$.registerChatCommand("./systems/raffleSystem.js","raffle",2)}})})();
