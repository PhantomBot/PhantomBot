!function(){function e(e,t){this.youtubeVideo=e,this.username=t,this.isOverRequestLimit=function(){var e,t=0;for(e in x)x[e].username==this.username&&t++;return t>=g},this.isQueueDuplicate=function(){var e;for(e in x)if(x[e].videoId==this.youtubeVideo.videoId)return!0;return!1},this.isVideoTooLong=function(){return parseInt(this.youtubeVideo.getVideoLength())>parseInt(b)},this.request=function(){return this.youtubeVideo.found?this.isOverRequestLimit()?($.say($.whisperPrefix(this.username)+$.lang.get("youtubeplayer.request.error.overlimit",g)),$.returnCommandCost(this.username,"addsong"),!1):this.isQueueDuplicate()?($.say($.whisperPrefix(this.username)+$.lang.get("youtubeplayer.request.error.alreadyexists")),$.returnCommandCost(this.username,"addsong"),!1):this.isVideoTooLong()?($.say($.whisperPrefix(this.username)+$.lang.get("youtubeplayer.request.error.toolong",this.youtubeVideo.videoTitle,$.getTimeString(this.youtubeVideo.getVideoLength()),$.getTimeString(b))),$.returnCommandCost(this.username,"addsong"),!1):(x.push(this.youtubeVideo),o(),$.say($.lang.get("youtubeplayer.request.success",this.youtubeVideo.videoTitle,$.resolveRank(this.username))),null==C&&s(),!0):($.say($.whisperPrefix(this.username)+$.lang.get("youtubeplayer.request.error.404",this.youtubeVideo.link)),$.returnCommandCost(this.username,"addsong"),!1)}}function t(e,t){this.link=e,this.username=(t+"").toLowerCase(),this.videoId="",this.videoTitle="",this.length=0,this.found=!0,this.getVideoLength=function(){for(var e=$.youtube.GetVideoLength(this.videoId);0==e[0]&&0==e[1]&&0==e[2];)e=$.youtube.GetVideoLength(this.videoId);return 0==e[0]&&0==e[1]&&0==e[2]?!1:(this.length=e[2],this.length)},this.cue=function(){$.musicplayer.cue(this.videoId)},this.link||(this.found=!1);for(var i=$.youtube.SearchForVideo(this.link);i[0].length()<11&&"No Search Results Found"!=i[1];)i=$.youtube.SearchForVideo(this.link);this.videoId=i[0],this.videoTitle=i[1],this.length=1,("Video Marked Private"==this.videoTitle||"No Search Results Found"==this.videoTitle)&&(this.found=!1),""==this.videoId&&(this.found=!1)}function i(){var e,i;if($.consoleLn($.lang.get("youtubeplayer.playlist.parse.default.start")),w=$.readFile(f+"playlist.txt").reverse(),w.length>0)for(e=0;e<w.length;e++)i=new t(w[e]),i?$.writeToFile(e+". "+i.videoTitle+" ("+i.link+")",f+"defaultPlaylist.txt",0!=e):$.writeToFile(e+". COULD NOT FIND! ("+i.link+")",f+"defaultPlaylist.txt",0!=e);$.consoleLn($.lang.get("youtubeplayer.playlist.parse.default.complete"))}function s(){var e,i;if(e=null,x.length>0)e=x.shift();else if(0==w.length)e=null;else{if(p){do i=$.randRange(0,w.length-1);while(i==P);v=P=i}else v<w.length?v++:v=0;e=new t(w[v],$.botName)}null==e?($.lang.exists("youtubeplayer.nothing-to-play")&&$.say($.lang.get("youtubeplayer.nothing-to-play")),C=null):n(e)}function a(e){var i,s;for(i in w)if(w[i].toLowerCase().indexOf(e.toLowerCase())>-1)return v=i,s=new t(w[i],$.botName),n(s),!0;return!1}function r(e){$.writeToFile("http://youtube.com/watch?v="+e.videoId,"./addons/youtubePlayer/playlist.txt",!0),i()}function u(e){var s,a,r=new t(w[e]);w.splice(e,1),s=w.reverse();for(a in s)$.writeToFile(s[a],"./addons/youtubePlayer/playlist.txt",0!=a);return i(),r.videoTitle}function n(e){e&&(C=e,e.cue(),$.writeToFile(e.videoTitle,f+"currentSong.txt",!1),y?$.say($.lang.get("youtubeplayer.nowplaying.get",e.videoTitle,$.resolveRank(e.username))):$.consoleLn($.lang.get("youtubeplayer.nowplaying.get",e.videoTitle,$.resolveRank(e.username)))),o()}function o(e){var t;if(e)return void $.writeToFile("",f+"requestQueue.txt",!1);if(x.length>0)for(t in x)$.writeToFile(x[t].videoTitle+" (By "+$.username.resolve(x[t].username)+")",f+"requestQueue.txt",0!=t)}function l(){c?$.musicplayer.play():$.musicplayer.pause(),c=!c}var y=$.inidb.exists("youtubePlayer","updatesInChat")?$.getIniDbBoolean("youtubePlayer","updatesInChat"):!1,g=$.inidb.exists("youtubePlayer","requestLimit")?parseInt($.inidb.get("youtubePlayer","requestLimit")):3,d=$.inidb.exists("youtubePlayer","playerVolume")?parseInt($.inidb.get("youtubePlayer","playerVolume")):20,p=$.inidb.exists("youtubePlayer","shuffleDefaultPlaylist")?$.getIniDbBoolean("youtubePlayer","shuffleDefaultPlaylist"):!1,h=$.inidb.exists("youtubePlayer","requestsEnabled")?$.getIniDbBoolean("youtubePlayer","requestsEnabled"):!0,b=$.inidb.exists("youtubePlayer","maxVideoLength")?parseInt($.inidb.get("youtubePlayer","maxVideoLength")):600,f="./addons/youtubePlayer/",m=!1,c=!1,v=-1,P=-1,w=[],x=[],C=null;$.bind("musicPlayerConnect",function(){m=!0,$.youtubePlayerConnected=m,0==w.length&&i(),y&&h&&$.say($.lang.get("youtubeplayer.requests.enabled")+" "+$.lang.get("youtubeplayer.request.usage"))}),$.bind("musicPlayerDisconnect",function(){m=!1,$.youtubePlayerConnected=m,o(!0),y&&h&&$.say("[â™«] Song requests have been disabled.")}),$.bind("musicPlayerState",function(e){$.musicplayer.setVolume(d),-2==e.getStateId()&&(x=[],s()),0==e.getStateId()&&s(),5==e.getStateId()&&($.musicplayer.play(),$.musicplayer.currentId())}),$.bind("command",function(n){var o,c=n.getSender().toLowerCase(),v=n.getCommand(),P=n.getArgs(),I=P[0]?P[0]:"",q=P[1];if(v.equalsIgnoreCase("musicplayer")){if(!$.isAdmin(c))return void $.say($.whisperPrefix(c)+$.adminMsg);if(!I)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.musicplayer.usage",g));if(I.equalsIgnoreCase("togglenotify")&&(y=!y,$.setIniDbBoolean("youtubePlayer","updatesInChat",y),$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.toggle.chatnotifications.success",y?$.lang.get("common.enabled"):$.lang.get("common.disabled")))),I.equalsIgnoreCase("limit")){if(!q||isNaN(parseInt(q)))return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.set.requestlimit.usage",g));g=parseInt(q),$.inidb.set("youtubePlayer","requestLimit",g),$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.set.requestlimit.success",g))}if(I.equalsIgnoreCase("maxvideolength")){if(!q||isNaN(parseInt(q)))return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.set.maxvideolength.usage",$.getTimeString(b)));b=60*parseInt(q),$.inidb.set("youtubePlayer","maxVideoLength",b),$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.set.maxvideolength.success",$.getTimeString(b)))}if(I.equalsIgnoreCase("shuffle")&&(p=!p,$.setIniDbBoolean("youtubePlayer","shuffleDefaultPlaylist",p),$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.toggle.songshuffle.success",p?$.lang.get("common.enabled"):$.lang.get("common.disabled")))),I.equalsIgnoreCase("pause")&&l(),I.equalsIgnoreCase("reload")&&(i(),$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.playlist.reload.success"))),I.equalsIgnoreCase("adddefault")){if(!q)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.playlist.adddefault.usage"));o=new t(q,c),o?(r(o),$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.playlist.adddefault.success",o.videoTitle))):$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.playlist.adddefault.failed"))}if(I.equalsIgnoreCase("deldefault")){if(q=parseInt(q),isNaN(q)||!w[q])return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.playlist.deletedefault.usage"));$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.playlist.deletedefault.success",u(q)))}}if(v.equalsIgnoreCase("addsong")){if(!h)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.request.error.disabled"));if(!I)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.request.usage"));if(!m)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.request.error.notrunning"));o=new e(new t(P.join(" "),c),c),o.youtubeVideo&&o.request()}if(v.equalsIgnoreCase("volume")){if(!$.isAdmin(c))return void $.say($.whisperPrefix(c)+$.adminMsg);q||isNaN(parseInt(I))?m?$.say($.lang.get("youtubeplayer.volume.current",$.inidb.get("youtubePlayer","playerVolume"))):$.say($.lang.get("youtubeplayer.notrunning")):(d=parseInt(I),m?($.inidb.set("youtubePlayer","playerVolume",d),$.musicplayer.setVolume(d),$.say($.lang.get("youtubeplayer.volume.current",$.inidb.get("youtubePlayer","playerVolume")))):$.say($.lang.get("youtubeplayer.notrunning")))}if(v.equalsIgnoreCase("skipsong")){if(!$.isAdmin(c))return void $.say($.whisperPrefix(c)+$.adminMsg);if(!m)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.notrunning"));s()}if(v.equalsIgnoreCase("currentsong")){if(!m)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.notrunning"));null!=C?$.say($.lang.get("youtubeplayer.nowplaying.getwithlink",C.videoTitle,$.resolveRank(C.username),C.link)):$.lang.exists("youtubeplayer.nothing-to-play")&&$.say($.lang.get("youtubeplayer.nothing-to-play"))}if(v.equalsIgnoreCase("stealsong")){if(!$.isAdmin(c))return void $.say($.whisperPrefix(c)+$.adminMsg);if(!m)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.notrunning"));C?($.writeToFile("https://youtube.com/watch?v="+C.videoId,f+"playlist.txt",!0),$.say($.lang.get("youtubeplayer.stealsong.success",C.videoTitle,$.resolveRank(C.username))),i()):$.say($.lang.get("youtubeplayer.stealsong.404"))}if(v.equalsIgnoreCase("playsong")){if(!$.isAdmin(c))return void $.say($.whisperPrefix(c)+$.adminMsg);if(!m)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.notrunning"));if(x.length>0)return void $.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.playsong.requestsrunning"));I&&(a(I)||$.say($.whisperPrefix(c)+$.lang.get("youtubeplayer.playsong.404",I)))}if(v.equalsIgnoreCase("togglerequests")){if(!$.isAdmin(c))return void $.say($.whisperPrefix(c)+$.adminMsg);h=!h,$.setIniDbBoolean("youtubePlayer","requestsEnabled",h),h?$.say($.lang.get("youtubeplayer.requests.enabled")):$.say($.lang.get("youtubeplayer.requests.disabled"))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/youtubePlayer.js")&&(0==w.length&&i(),$.registerChatCommand("./systems/youtubePlayer.js","musicplayer",1),$.registerChatCommand("./systems/youtubePlayer.js","volume",1),$.registerChatCommand("./systems/youtubePlayer.js","skipsong",1),$.registerChatCommand("./systems/youtubePlayer.js","stealsong",1),$.registerChatCommand("./systems/youtubePlayer.js","playsong",1),$.registerChatCommand("./systems/youtubePlayer.js","togglerequests",1),$.registerChatCommand("./systems/youtubePlayer.js","addsong",6),$.registerChatCommand("./systems/youtubePlayer.js","currentsong",7))})}();
