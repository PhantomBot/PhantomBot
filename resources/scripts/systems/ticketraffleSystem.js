!function(){function e(e,s,r,i){return g?void $.say($.whisperPrefix(e)+$.lang.get("ticketrafflesystem.err.raffle.opened")):s?(s&&(f=parseInt(s)),r&&(a=parseInt(r)),i&&i.equalsIgnoreCase("-followers")&&(l=!0,m=$.lang.get("ticketrafflesystem.msg.need.to.be.follwing")),void t(f,l,a,m)):void $.say($.whisperPrefix(e)+$.lang.get("ticketrafflesystem.err.missing.syntax"))}function t(e,t,s,r){$.say($.lang.get("ticketrafflesystem.raffle.opened",e,$.getPointsString(s),r)),g=!0,n=[]}function s(e){return g?(g=!1,l=!1,f=0,a=0,m="",$.say($.lang.get("ticketrafflesystem.raffle.closed")),void r()):void $.say($.whisperPrefix(e)+$.lang.get("ticketrafflesystem.err.raffle.not.opened"))}function r(e){if(0==n.length)return void $.say($.lang.get("ticketrafflesystem.raffle.close.err"));if(e)return void $.say($.lang.get("ticketrafflesystem.raffle.repick",$.username.resolve($.randElement(n))));var t=$.randElement(n);$.inidb.set("traffleresults","winner",$.username.resolve(t)),$.say($.lang.get("ticketrafflesystem.winner",$.username.resolve(t)))}function i(e,t){if(!g)return void $.say($.whisperPrefix(e)+$.lang.get("ticketrafflesystem.err.raffle.not.opened"));if(t>f||0==t)return void $.say($.whisperPrefix(e)+$.lang.get("ticketrafflesystem.only, buy.amount",f));for(var s=0,r=0;s<n.length;s++)if(n[s].equalsIgnoreCase(e)&&(r++,r+t>f))return void $.say($.whisperPrefix(e)+$.lang.get("ticketrafflesystem.litmi.hit",f));if(l&&!$.user.isFollower(e))return void $.say($.whisperPrefix(e)+$.lang.get("ticketrafflesystem.err.not.following"));if(a>0&&t*a>$.getUserPoints(e))return void $.say($.whisperPrefix(e)+$.lang.get("ticketrafflesystem.err.points",$.pointNameMultiple));$.inidb.decr("points",e,t*a),o&&$.say($.lang.get("ticketrafflesystem.entered",$.username.resolve(e),t));for(var s=0;t>s;s++)n.push(e)}var a=0,n=[],f=0,l=!1,g=!1,o=$.inidb.exists("settings","tRaffleMSGToggle")?$.getIniDbBoolean("settings","tRaffleMSGToggle"):!0,m="";$.bind("command",function(t){var a=t.getSender(),n=t.getCommand(),f=(t.getArguments(),t.getArgs()),l=f[0];if(n.equalsIgnoreCase("traffle")){if(!$.isModv3(a,t.getTags()))return void $.say($.whisperPrefix(a)+$.modMsg);if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.usage"));l.equalsIgnoreCase("open")&&e(a,f[1],f[2],f[3]),l.equalsIgnoreCase("close")&&s(a),l.equalsIgnoreCase("repick")&&r(!0),l.equalsIgnoreCase("messagetoggle")&&(o?(o=!1,$.inidb.set("settings","tRaffleMSGToggle",o),$.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.msg.disabled"))):(o=!0,$.inidb.set("settings","tRaffleMSGToggle",o),$.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.msg.enabled"))))}if(n.equalsIgnoreCase("tickets")){if(!l)return void $.say($.whisperPrefix(a)+$.lang.get("ticketrafflesystem.ticket.usage"));i(a,parseInt(l))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/ticketRaffleSystem.js")&&($.registerChatCommand("./systems/ticketRaffleSystem.js","traffle",2),$.registerChatCommand("./systems/ticketRaffleSystem.js","tickets",7))})}();
