!function(){function e(){var e,i=$.inidb.GetKeyList("notices",""),n=0;for(e=0;e<i.length;e++)$.inidb.set("tempnotices",i[e],$.inidb.get("notices",i[e]));for($.inidb.RemoveFile("notices"),i=$.inidb.GetKeyList("tempnotices",""),e=0;e<i.length;e++)$.inidb.set("notices","message_"+n,$.inidb.get("tempnotices",i[e])),n++;$.inidb.RemoveFile("tempnotices")}function i(){var e=Packages.me.mast3rplan.phantombot.event.EventBus,i=Packages.me.mast3rplan.phantombot.event.command.CommandEvent,n=$.inidb.get("notices","message_"+c);c++,c>=a&&(c=0),n.startsWith("command:")?(n=n.substring(8),e.instance().postCommand(new i($.botName,n," "))):$.say(n)}function n(){t=$.getIniDbNumber("noticeSettings","reqmessages"),s=$.getIniDbNumber("noticeSettings","interval"),o=$.getIniDbBoolean("noticeSettings","noticetoggle"),r=$.getIniDbBoolean("noticeSettings","noticeOffline")}var t=$.getSetIniDbNumber("noticeSettings","reqmessages",25),s=$.getSetIniDbNumber("noticeSettings","interval",10),o=$.getSetIniDbBoolean("noticeSettings","noticetoggle",!1),a=parseInt($.inidb.GetKeyList("notices","").length)?parseInt($.inidb.GetKeyList("notices","").length):0,r=$.getSetIniDbBoolean("noticeSettings","noticeOffline",!0),g=0,c=0;$.bind("ircChannelMessage",function(){g++}),$.bind("command",function(c){var l=c.getSender(),d=c.getCommand(),m=c.getArguments().trim(),h=c.getArgs(),f=h[0];if(d.equalsIgnoreCase("notice")){if(!$.isAdmin(l))return void $.say($.whisperPrefix(l)+$.adminMsg);if(0==h.length)return void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-usage"));if(f.equalsIgnoreCase("get"))return h.length<2?void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-get-usage",a)):$.inidb.exists("notices","message_"+h[1])?void $.say($.inidb.get("notices","message_"+h[1])):void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-error-notice-404"));if(f.equalsIgnoreCase("edit"))return h.length<3?void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-edit-usage",a)):$.inidb.exists("notices","message_"+h[1])?(m=m.replace(f+" "+h[1],"").trim(),$.inidb.set("notices","message_"+h[1],m),void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-edit-success"))):void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-error-notice-404"));if(f.equalsIgnoreCase("remove"))return h.length<2?void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-remove-usage",a)):$.inidb.exists("notices","message_"+h[1])?($.inidb.del("notices","message_"+h[1]),a--,e(),void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-remove-success"))):void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-error-notice-404"));if(f.equalsIgnoreCase("add"))return h.length<2?void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-add-usage")):(m=m.replace(f+"","").trim(),$.inidb.set("notices","message_"+a,m),a++,void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-add-success")));if(f.equalsIgnoreCase("interval"))return h.length<2?void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-interval-usage")):parseInt(h[1])<2?void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-interval-404")):($.inidb.set("noticeSettings","interval",h[1]),s=parseInt(h[1]),$.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-inteval-success")),void setInterval(function(){o&&$.bot.isModuleEnabled("./systems/noticeSystem.js")&&a>0&&g>=t&&r&&$.isOnline($.channelName)&&(i(),g=0)},60*s*1e3,"noticeTimer"));if(f.equalsIgnoreCase("req"))return h.length<2?void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-req-usage")):parseInt(h[1])<1?void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-req-404")):($.inidb.set("noticeSettings","reqmessages",h[1]),t=parseInt(h[1]),void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-req-success")));if(f.equalsIgnoreCase("config"))return void $.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-config",o,s,t,a,r));f.equalsIgnoreCase("toggle")&&(o?(o=!1,$.inidb.set("noticeSettings","noticetoggle","false"),$.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-disabled"))):(o=!0,$.inidb.set("noticeSettings","noticetoggle","true"),$.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-enabled")))),f.equalsIgnoreCase("toggleoffline")&&(r?(r=!1,$.inidb.set("noticeSettings","noticeOffline","false"),$.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-disabled.offline"))):(r=!0,$.inidb.set("noticeSettings","noticeOffline","true"),$.say($.whisperPrefix(l)+$.lang.get("noticehandler.notice-enabled.offline"))))}if(d.equalsIgnoreCase("reloadnotice")){if(!$.isAdmin(l))return;n()}}),setInterval(function(){o&&$.bot.isModuleEnabled("./systems/noticeSystem.js")&&a>0&&g>=t&&(r&&!$.isOnline($.channelName)||$.isOnline($.channelName))&&(i(),g=0)},60*s*1e3,"noticeTimer"),$.bind("initReady",function(){$.bot.isModuleEnabled("./systems/noticeSystem.js")&&($.registerChatCommand("./systems/noticeSystem.js","notice",1),$.registerChatCommand("./systems/noticeSystem.js","reloadnotice"))})}();
