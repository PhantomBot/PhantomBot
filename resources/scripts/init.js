!function(){function e(e,i,n){this.scriptFile=e,this.script=i,this.enabled=n,e.indexOf("./core/")>-1&&(this.enabled=!0),this.getModuleName=function(){return this.scriptFile.replace(/([a-z]+)\.js$/i,"$1")}}function i(e,i,n){this.scriptFile=e,this.hook=i,this.handler=n}function n(e){Packages.com.gmt2001.Console.out.println(java.util.Objects.toString(e))}function t(e){Packages.com.gmt2001.Console.debug.println(java.util.Objects.toString(e))}function s(){var e,i=function(e){var i,n=["getClass","equals","notify","class","hashCode","toString","wait","notifyAll"];for(i in n)if(n[i]==e)return!0;return!1},n=function(e,i){return function(){for(var n=[$script],t=0;t<arguments.length;t++)n.push(arguments[t]);e[i].save(e,n)}};for(e in $api)i(e)||("function"==typeof $api[e]?$[e]=n($api,e):$[e]=$api[e])}function o(i,t,s){if(!l(i)||t){if(!i.endsWith(".js"))return;try{var o,r=$api.loadScriptR($script,i);$.inidb.exists("modules",i)?o=$.getIniDbBoolean("modules",i):(o=!0,$.setIniDbBoolean("modules",i,o)),b.push(new e(i,r,o)),s||n("Loaded module: "+i.replace(/\.\//g,"")+" ("+(o?"Enabled":"Disabled")+")")}catch(a){n('Failed loading "'+i+'": '+a),l("./core/logging.js")&&$.logError("init.js",70,"(loadScript, "+i+") "+a)}}}function r(e,i){e.substring($.strlen(e)-1).equalsIgnoreCase("/")&&(e=e.substring(0,$.strlen(e)-1));var n,t=$.findFiles("./scripts/"+e,"");for(n=0;n<t.length;n++)e.equalsIgnoreCase(".")&&(t[n].equalsIgnoreCase("util")||t[n].equalsIgnoreCase("lang")||t[n].equalsIgnoreCase("init.js")||t[n].equalsIgnoreCase("dev"))||($.isDirectory("./scripts/"+e+"/"+t[n])?r(e+"/"+t[n],i):o(e+"/"+t[n],!1,i))}function a(e){var i;for(i in b)if(b[i].scriptFile.equalsIgnoreCase(e))return i;return-1}function c(e){var i=a(e);return i>-1?b[i].enabled:!1}function l(e){return a(e)>-1}function u(e){var i=a(e);return i>-1?b[i]:null}function d(e,i){var n;for(n in w)if(w[n].scriptFile.equalsIgnoreCase(e)&&w[n].hook.equalsIgnoreCase(i))return n;return-1}function g(e,n){var t=$script.getPath().replace("\\","/").replace("./scripts/",""),s=d(t,e);s>-1?w[s].handler=n:w.push(new i(t,e,n))}function p(e){var i=$script.getPath().replace("\\","/").replace("./scripts/",""),n=d(i,e);n>-1&&w.splice(n,1)}function m(e,i,n){var t;if("command"==e){var t=d(getCommandScript(i.getCommand()),e);if(-1==t)return;if(c(w[t].scriptFile)||n)try{w[t].handler(i)}catch(s){$.logError("init.js",265,"(hook.call, "+e+", "+w[t].scriptFile+") "+s)}}else for(t in w)if(w[t].hook.equalsIgnoreCase(e)&&(c(w[t].scriptFile)||n))try{w[t].handler(i)}catch(s){$.logError("init.js",274,"(hook.call, "+e+", "+w[t].scriptFile+") "+s)}}function f(){s(),o("./core/misc.js"),o("./core/jsTimers.js"),o("./core/updates.js"),o("./core/fileSystem.js"),o("./core/lang.js"),o("./core/logging.js"),o("./core/commandRegister.js"),o("./core/whisper.js"),o("./core/chatModerator.js"),o("./core/commandCoolDown.js"),o("./core/gameMessages.js"),o("./core/patternDetector.js"),o("./core/permissions.js"),o("./core/streamInfo.js"),o("./core/timeSystem.js"),$.logEvent("init.js",285,"Core loaded, initializing bot..."),r("."),$api.on($script,"ircChannelMessage",function(e){n($.username.resolve(e.getSender().toLowerCase(),e.getTags())+": "+e.getMessage()),e.getSender().equalsIgnoreCase("jtv")||e.getSender().equalsIgnoreCase("twitchnotify")?m("ircPrivateMessage",e,!1):m("ircChannelMessage",e,!1)}),$api.on($script,"ircJoinComplete",function(e){h=!0,$.channel=e.getChannel()}),$api.on($script,"ircChannelUserMode",function(e){h&&e.getChannel().getName().equalsIgnoreCase($.channel.getName())&&e.getUser().equalsIgnoreCase($.botName)&&e.getMode().equalsIgnoreCase("o")&&e.getAdd()&&(C||$.consoleLn($.username.resolve($.botName)+" ready!"),C=!0)}),$api.on($script,"command",function(e){var i,n,s,o=e.getSender(),r=e.getArgs(),a=e.getCommand();if(!$.isModv3(o,e.getTags())&&$.commandPause.isPaused())return void t($.lang.get("commandpause.isactive"));if($.inidb.exists("aliases",a)&&e.setCommand($.inidb.get("aliases",a)),i=e.getCommand().toLowerCase(),!$.commandExists(i))return void t("that command does not exists.");if(n=r[0]?r[0]:"",!$.permCom(o,i,n))return void $.say($.whisperPrefix(o)+$.lang.get("cmd.perm.404",$.getCommandGroupName(i)));if(!$.isAdmin(o)&&(s=$.coolDown.get(i,o),s>0))return void t("command "+i+" was not sent because it is still on a cooldown.");if(c("./systems/pointSystem.js")&&!$.isModv3(o,e.getTags())&&$.inidb.exists("pricecom",i)){if($.getUserPoints(o)<$.getCommandPrice(i))return void $.say($.whisperPrefix(o)+$.lang.get("cmd.needpoints",$.getPointsString($.inidb.get("pricecom",i))));parseInt($.inidb.get("pricecom",i))>0&&$.inidb.decr("points",o,$.inidb.get("pricecom",i))}m("command",e,!1)}),$api.on($script,"consoleInput",function(e){m("consoleInput",e,!0)}),$api.on($script,"twitchFollow",function(e){m("twitchFollow",e,!0)}),$api.on($script,"twitchUnfollow",function(e){m("twitchUnfollow",e,!0)}),$api.on($script,"twitchFollowsInitialized",function(e){m("twitchFollowsInitialized",e,!0)}),$api.on($script,"twitchHosted",function(e){m("twitchHosted",e,!0)}),$api.on($script,"twitchUnhosted",function(e){m("twitchUnhosted",e,!0)}),$api.on($script,"twitchHostsInitialized",function(e){m("twitchHostsInitialized",e,!0)}),$api.on($script,"twitchSubscribe",function(e){m("twitchSubscribe",e,!0)}),$api.on($script,"twitchUnsubscribe",function(e){m("twitchUnsubscribe",e,!0)}),$api.on($script,"twitchSubscribesInitialized",function(e){m("twitchSubscribesInitialized",e,!0)}),$api.on($script,"ircChannelJoin",function(e){m("ircChannelJoin",e,!0)}),$api.on($script,"ircChannelLeave",function(e){m("ircChannelLeave",e,!0)}),$api.on($script,"ircChannelUserMode",function(e){m("ircChannelUserMode",e,!0)}),$api.on($script,"ircConnectComplete",function(e){m("ircConnectComplete",e,!0)}),$api.on($script,"ircJoinComplete",function(e){m("ircJoinComplete",e,!0)}),$api.on($script,"ircPrivateMessage",function(e){m("ircPrivateMessage",e,!1)}),$api.on($script,"musicPlayerConnect",function(e){m("musicPlayerConnect",e,!1)}),$api.on($script,"musicPlayerCurrentId",function(e){m("musicPlayerCurrentId",e,!1)}),$api.on($script,"musicPlayerCurrentVolume",function(e){m("musicPlayerCurrentVolume",e,!1)}),$api.on($script,"musicPlayerDisconnect",function(e){m("musicPlayerDisconnect",e,!1)}),$api.on($script,"musicPlayerState",function(e){m("musicPlayerState",e,!1)}),$api.on($script,"twitchAlertsDonation",function(e){m("twitchAlertsDonation",e,!0)}),$api.on($script,"twitchAlertsDonationInitialized",function(e){m("twitchAlertsDonationInitialized",e,!0)}),$api.on($script,"emotesGet",function(e){m("emotesGet",e,!0)}),$api.on($script,"ircChannelJoinUpdate",function(e){m("ircChannelJoinUpdate",e,!0)}),$.logEvent("init.js",553,"Bot locked & loaded!"),$.consoleDebug("Bot locked & loaded!"),$.consoleLn(""),$api.on($script,"command",function(e){var i,n,t=e.getSender().toLowerCase(),s=$.username.resolve(t,e.getTags()),r=e.getCommand(),c=e.getArgs(),l=c[0],u=[];if(r.equalsIgnoreCase("reconnect")){if(!$.isModv3(t,e.getTags()))return void $.say($.whisperPrefix(t)+$.modMsg);$.logEvent("init.js",354,s+" requested a reconnect!"),$.connmgr.reconnectSession($.hostname),$.say($.lang.get("init.reconnect"))}if(r.equalsIgnoreCase("module")){if(!$.isAdmin(t))return void $.say($.whisperPrefix(t)+$.adminMsg);if(!l)return void $.say($.whisperPrefix(t)+$.lang.get("init.module.usage"));if(l.equalsIgnoreCase("list")){var d="";for(n in b)-1==b[n].scriptFile.indexOf("./core/")&&-1==b[n].scriptFile.indexOf("./lang/")&&(d+=" - ",d+=b[n].scriptFile+" (",d+=b[n].enabled?"enabled":"disabled",d+=")");$.say($.whisperPrefix(t)+d)}if(l.equalsIgnoreCase("enable")){if(i=c[1],!i)return void $.say($.whisperPrefix(t)+$.lang.get("init.module.usage"));if(i.indexOf("./core/")>-1||i.indexOf("./lang/")>-1)return;n=a(i),n>-1?($.logEvent("init.js",393,s+' enabled module "'+b[n].scriptFile+'"'),b[n].enabled=!0,$.setIniDbBoolean("modules",b[n].scriptFile,!0),o(b[n].scriptFile),m("initReady",null,!0),$.say($.whisperPrefix(t)+$.lang.get("init.module.enabled",b[n].getModuleName()))):$.say($.whisperPrefix(t)+$.lang.get("init.module.404"))}if(l.equalsIgnoreCase("disable")){if(i=c[1],!i)return void $.say($.whisperPrefix(t)+$.lang.get("init.module.usage"));if(i.indexOf("./core/")>-1||i.indexOf("./lang/")>-1)return;if(n=a(i),n>-1){if($.logEvent("init.js",393,s+' disabled module "'+b[n].scriptFile+'"'),b[n].enabled=!1,$.setIniDbBoolean("modules",b[n].scriptFile,!1),$.say($.whisperPrefix(t)+$.lang.get("init.module.disabled",b[n].getModuleName())),"./systems/pointSystem.js"==b[n].scriptFile){u.push("./games/adventureSystem.js"),u.push("./games/roll.js"),u.push("./games/slotMachine.js"),u.push("./systems/ticketRaffleSystem.js"),u.push("./systems/raffleSystem.js");for(var g=0;g<u.length;g++)n=a(u[g]),n>-1&&($.logEvent("init.js",393,s+' auto-disabled module "'+b[n].scriptFile+'"'),b[n].enabled=!1,$.setIniDbBoolean("modules",b[n].scriptFile,!1));$.say($.whisperPrefix(t)+$.lang.get("init.module.auto-disabled"))}}else $.say($.whisperPrefix(t)+$.lang.get("init.module.404"))}if(l.equalsIgnoreCase("status")){if(i=c[1],!i)return void $.say($.whisperPrefix(t)+$.lang.get("init.module.usage"));n=a(i),n>1?b[n].enabled?$.say($.whisperPrefix(t)+$.lang.get("init.module.check.enabled",b[n].getModuleName())):$.say($.whisperPrefix(t)+$.lang.get("init.module.check.disabled",b[n].getModuleName())):$.say($.whisperPrefix(t)+$.lang.get("init.module.404"))}}r.equalsIgnoreCase("chat")&&$.say(e.getArguments())}),$.registerChatCommand("./init.js","chat",1),$.registerChatCommand("./init.js","module",1),$.registerChatCommand("./init.js","reconnect",2),m("initReady",null,!0)}var h=!1,C=!1,b=[],w=[];$.consoleLn=n,$.consoleDebug=t,$.bind=g,$.unbind=p,$.bot={loadScript:o,loadScriptRecursive:r,isModuleLoaded:l,isModuleEnabled:c,getModule:u},f()}();
