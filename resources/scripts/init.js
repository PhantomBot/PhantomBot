(function(){var e=false,i=false,t=[],n=[];function s(e,i,t){this.scriptFile=e;this.script=i;this.enabled=t;if(e.indexOf("./core/")>-1){this.enabled=true}this.getModuleName=function(){return this.scriptFile.replace(/([a-z]+)\.js$/i,"$1")}}function r(e,i,t){this.scriptFile=e;this.hook=i;this.handler=t}function o(e){Packages.com.gmt2001.Console.out.println(java.util.Objects.toString(e))}function a(){var e,i=function(e){var i=["getClass","equals","notify","class","hashCode","toString","wait","notifyAll"],t;for(t in i){if(i[t]==e){return true}}return false},t=function(e,i){return function(){var t=[$script];for(var n=0;n<arguments.length;n++){t.push(arguments[n])}e[i].save(e,t)}};for(e in $api){if(i(e)){continue}if(typeof $api[e]=="function"){$[e]=t($api,e)}else{$[e]=$api[e]}}}function c(e,i,n){if(!g(e)||i){try{var r=$api.loadScriptR($script,e),a;if(!$.inidb.exists("modules",e)){a=true;$.setIniDbBoolean("modules",e,a)}else{a=$.getIniDbBoolean("modules",e)}t.push(new s(e,r,a));if(!n){o("Loaded module: "+e.replace(/\.\//g,"")+" ("+(a?"Enabled":"Disabled")+")")}}catch(c){o('Failed loading "'+e+'": '+c);if(g("./core/logging.js")){$.logError("init.js",70,"(loadScript, "+e+") "+c)}}}}function l(e,i){if(e.substring($.strlen(e)-1).equalsIgnoreCase("/")){e=e.substring(0,$.strlen(e)-1)}var t=$.findFiles("./scripts/"+e,""),n;for(n=0;n<t.length;n++){if(e.equalsIgnoreCase(".")){if(t[n].equalsIgnoreCase("util")||t[n].equalsIgnoreCase("lang")||t[n].equalsIgnoreCase("init.js")||t[n].equalsIgnoreCase("dev")){continue}}if($.isDirectory("./scripts/"+e+"/"+t[n])){l(e+"/"+t[n],i)}else{c(e+"/"+t[n],false,i)}}}function u(e){var i;for(i in t){if(t[i].scriptFile.equalsIgnoreCase(e)){return i}}return-1}function f(e){var i=u(e);if(i>-1){return t[i].enabled}return false}function g(e){return u(e)>-1}function d(e){var i=u(e);if(i>-1){return t[i]}return null}function p(e,i){var t;for(t in n){if(n[t].scriptFile.equalsIgnoreCase(e)&&n[t].hook.equalsIgnoreCase(i)){return t}}return-1}function m(e,i){var t=$script.getPath().replace("\\","/").replace("./scripts/",""),s=p(t,e);if(s>-1){n[s].handler=i}else{n.push(new r(t,e,i))}}function h(e){var i=$script.getPath().replace("\\","/").replace("./scripts/",""),t=p(i,e);if(t>-1){n.splice(t,1)}}function C(e,i,t){var s;for(s in n){if(n[s].hook.equalsIgnoreCase(e)&&(f(n[s].scriptFile)||t)){try{n[s].handler(i)}catch(r){$.logError("init.js",173,"(hook.call, "+e+", "+n[s].scriptFile+") "+r)}}}}function w(){a();c("./core/misc.js");c("./core/jsTimers.js");c("./core/updates.js");c("./core/fileSystem.js");c("./core/lang.js");c("./core/logging.js");c("./core/commandRegister.js");c("./core/whisper.js");c("./core/chatModerator.js");c("./core/commandCoolDown.js");c("./core/gameMessages.js");c("./core/patternDetector.js");c("./core/permissions.js");c("./core/streamInfo.js");c("./core/pointSystem.js");c("./core/ranks.js");c("./core/timeSystem.js");$.logEvent("init.js",285,"Core loaded, initializing bot...");l(".");$api.on($script,"ircChannelMessage",function(e){o($.username.resolve(e.getSender().toLowerCase(),e.getTags())+": "+e.getMessage());if(e.getSender().equalsIgnoreCase("jtv")||e.getSender().equalsIgnoreCase("twitchnotify")){C("ircPrivateMessage",e,false)}else{C("ircChannelMessage",e,false)}});$api.on($script,"ircJoinComplete",function(i){e=true;$.channel=i.getChannel()});$api.on($script,"ircChannelUserMode",function(t){if(!e){return}if(t.getChannel().getName().equalsIgnoreCase($.channel.getName())){if(t.getUser().equalsIgnoreCase($.botName)&&t.getMode().equalsIgnoreCase("o")){if(t.getAdd()){if(!i){$.consoleLn($.username.resolve($.botName)+" is ready to receive commands!")}i=true}}}});$api.on($script,"command",function(e){var i=e.getSender().toLowerCase(),t=e.getTags(),n=e.getCommand().toLowerCase(),s,r;if(!$.isModv3(i,t)&&$.commandPause.isPaused()){return}if($.inidb.exists("aliases",n)){e.setCommand($.inidb.get("aliases",n))}r=e.getCommand().toLowerCase();if(!$.commandExists(r)){return}if(!$.permCom(i,r)){return}if(!$.isAdmin(i)){s=$.coolDown.get(r,i);if(s>0){return}}if(f("./core/pointSystem.js")&&!$.isModv3(i,e.getTags())&&$.inidb.exists("pricecom",r)){if($.getUserPoints(i)<$.getCommandPrice(r)){$.say($.whisperPrefix(i)+$.lang.get("cmd.needpoints",$.getPointsString($.inidb.get("pricecom",r))));return}if(parseInt($.inidb.get("pricecom",r))>0){$.inidb.decr("points",i,$.inidb.get("pricecom",r))}}C("command",e,false)});$api.on($script,"consoleInput",function(e){C("consoleInput",e,true)});$api.on($script,"twitchFollow",function(e){C("twitchFollow",e,true)});$api.on($script,"twitchUnfollow",function(e){C("twitchUnfollow",e,true)});$api.on($script,"twitchFollowsInitialized",function(e){C("twitchFollowsInitialized",e,true)});$api.on($script,"twitchHosted",function(e){C("twitchHosted",e,true)});$api.on($script,"twitchUnhosted",function(e){C("twitchUnhosted",e,true)});$api.on($script,"twitchHostsInitialized",function(e){C("twitchHostsInitialized",e,true)});$api.on($script,"twitchSubscribe",function(e){C("twitchSubscribe",e,true)});$api.on($script,"twitchUnsubscribe",function(e){C("twitchUnsubscribe",e,true)});$api.on($script,"twitchSubscribesInitialized",function(e){C("twitchSubscribesInitialized",e,true)});$api.on($script,"ircChannelJoin",function(e){C("ircChannelJoin",e,true)});$api.on($script,"ircChannelLeave",function(e){C("ircChannelLeave",e,true)});$api.on($script,"ircChannelUserMode",function(e){C("ircChannelUserMode",e,true)});$api.on($script,"ircConnectComplete",function(e){C("ircConnectComplete",e,true)});$api.on($script,"ircJoinComplete",function(e){C("ircJoinComplete",e,true)});$api.on($script,"ircPrivateMessage",function(e){C("ircPrivateMessage",e,false)});$api.on($script,"musicPlayerConnect",function(e){C("musicPlayerConnect",e,false)});$api.on($script,"musicPlayerCurrentId",function(e){C("musicPlayerCurrentId",e,false)});$api.on($script,"musicPlayerCurrentVolume",function(e){C("musicPlayerCurrentVolume",e,false)});$api.on($script,"musicPlayerDisconnect",function(e){C("musicPlayerDisconnect",e,false)});$api.on($script,"musicPlayerState",function(e){C("musicPlayerState",e,false)});$api.on($script,"twitchAlertsDonation",function(e){C("twitchAlertsDonation",e,true)});$api.on($script,"twitchAlertsDonationInitialized",function(e){C("twitchAlertsDonationInitialized",e,true)});$.logEvent("init.js",553,"Bot locked & loaded!");$.consoleLn("Bot locked & loaded!");$api.on($script,"command",function(e){var i=e.getSender().toLowerCase(),n=$.username.resolve(i,e.getTags()),s=e.getCommand(),r=e.getArgs(),o=r[0],a,l;if(s.equalsIgnoreCase("reconnect")){if(!$.isModv3(i,e.getTags())){$.say($.whisperPrefix(i)+$.modMsg);return}$.logEvent("init.js",354,n+" requested a reconnect!");$.connmgr.reconnectSession($.hostname);$.say($.lang.get("init.reconnect"))}if(s.equalsIgnoreCase("module")){if(!$.isAdmin(i)){$.say($.whisperPrefix(i)+$.adminMsg);return}if(!o){$.say($.whisperPrefix(i)+$.lang.get("init.module.usage"));return}if(o.equalsIgnoreCase("list")){a=[];for(l in t){if(t[l].enabled){a.push(t[l].getModuleName())}}$.say($.whisperPrefix(i)+$.lang.get("init.module.list",a.length,a.join(", ")))}if(o.equalsIgnoreCase("enable")){a=r[1];if(!a){$.say($.whisperPrefix(i)+$.lang.get("init.module.usage"));return}if(a.indexOf("./core/")>-1||a.indexOf("./lang/")>-1){return}l=u(a);if(l>-1){$.logEvent("init.js",393,n+' enabled module "'+t[l].scriptFile+'"');t[l].enabled=true;$.setIniDbBoolean("modules",t[l].scriptFile,true);c(t[l].scriptFile);C("initReady",null,true);$.say($.whisperPrefix(i)+$.lang.get("init.module.enabled",t[l].getModuleName()))}else{$.say($.whisperPrefix(i)+$.lang.get("init.module.404"))}}if(o.equalsIgnoreCase("disable")){a=r[1];if(!a){$.say($.whisperPrefix(i)+$.lang.get("init.module.usage"));return}if(a.indexOf("./core/")>-1||a.indexOf("./lang/")>-1){return}l=u(a);if(l>-1){$.logEvent("init.js",393,n+' disabled module "'+t[l].scriptFile+'"');t[l].enabled=false;$.setIniDbBoolean("modules",t[l].scriptFile,false);$.say($.whisperPrefix(i)+$.lang.get("init.module.disabled",t[l].getModuleName()))}else{$.say($.whisperPrefix(i)+$.lang.get("init.module.404"))}}if(o.equalsIgnoreCase("status")){a=r[1];if(!a){$.say($.whisperPrefix(i)+$.lang.get("init.module.usage"));return}l=u(a);if(l>1){if(t[l].enabled){$.say($.whisperPrefix(i)+$.lang.get("init.module.check.enabled",t[l].getModuleName()))}else{$.say($.whisperPrefix(i)+$.lang.get("init.module.check.disabled",t[l].getModuleName()))}}else{$.say($.whisperPrefix(i)+$.lang.get("init.module.404"))}}}if(s.equalsIgnoreCase("chat")){$.say(e.getArguments())}});$.registerChatCommand("./init.js","chat",1);$.registerChatCommand("./init.js","module",1);$.registerChatCommand("./init.js","reconnect",2);C("initReady",null,true)}$.consoleLn=o;$.bind=m;$.unbind=h;$.bot={loadScript:c,loadScriptRecursive:l,isModuleLoaded:g,isModuleEnabled:f,getModule:d};w()})();
