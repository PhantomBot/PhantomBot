!function(){function e(){s=$.getIniDbString("subscribeHandler","subscribeMessage"),r=$.getIniDbString("subscribeHandler","reSubscribeMessage"),i=$.getIniDbBoolean("subscribeHandler","subscriberWelcomeToggle"),b=$.getIniDbBoolean("subscribeHandler","reSubscriberWelcomeToggle"),n=$.getIniDbNumber("subscribeHandler","subscribeReward")}var s=$.getSetIniDbString("subscribeHandler","subscribeMessage","(name) just subscribed!"),r=$.getSetIniDbString("subscribeHandler","reSubscribeMessage","(name) just subscribed for (months) months in a row!"),i=$.getSetIniDbBoolean("subscribeHandler","subscriberWelcomeToggle",!0),b=$.getSetIniDbBoolean("subscribeHandler","reSubscriberWelcomeToggle",!0),n=$.getSetIniDbNumber("subscribeHandler","subscribeReward",0);$.bind("twitchSubscribesInitialized",function(){$.bot.isModuleEnabled("./handlers/subscribeHandler.js")&&($.consoleLn(">> Enabling subscriber announcements"),$.logEvent("subscribehandler.js",24,"Subscriber announcements enabled"))}),$.bind("twitchSubscribe",function(e){if($.bot.isModuleEnabled("./handlers/subscribeHandler.js")){var s=e.getSubscriber();$.inidb.exists("subscribed",s)?n>0&&$.bot.isModuleEnabled("./systems/pointSystem.js")&&$.inidb.incr("points",s,n):($.addSubUsersList(s),$.restoreSubscriberStatus(s,!0))}}),$.bind("twitchUnsubscribe",function(e){if($.bot.isModuleEnabled("./handlers/subscribeHandler.js")){var s=e.getSubscriber();$.inidb.exists("subscribed",s)&&($.delSubUsersList(s),$.restoreSubscriberStatus(s,!0))}}),$.bind("command",function(b){var a=b.getSender(),t=b.getCommand(),d=b.getArguments().trim(),u=b.getArgs();if(t.equalsIgnoreCase("subscribepanelupdate")&&e(),t.equalsIgnoreCase("subwelcometoggle"))return $.isAdmin(a)?i?($.inidb.set("subscribeHandler","subscriberWelcomeToggle",!1),i=!1,$.say($.whisperPrefix(a)+$.lang.get("subscribehandler.new.sub.toggle.off")),void $.logEvent("subscribehandler.js",83,a+" disabled subscriber announcements")):($.inidb.set("subscribeHandler","subscriberWelcomeToggle",!0),i=!0,$.say($.whisperPrefix(a)+$.lang.get("subscribehandler.new.sub.toggle.on")),void $.logEvent("subscribehandler.js",89,a+" enabled subscriber announcements")):void $.say($.whisperPrefix(a)+$.adminMsg);if(t.equalsIgnoreCase("resubwelcometoggle"))return $.isAdmin(a)?i?($.inidb.set("subscribeHandler","reSubscriberWelcomeToggle",!1),i=!1,$.say($.whisperPrefix(a)+$.lang.get("subscribehandler.resub.toggle.off")),void $.logEvent("subscribehandler.js",106,a+" disabled re-subscriber announcements")):($.inidb.set("subscribeHandler","reSubscriberWelcomeToggle",!0),i=!0,$.say($.whisperPrefix(a)+$.lang.get("subscribehandler.resub.toggle.on")),void $.logEvent("subscribehandler.js",112,a+" enabled re-subscriber announcements")):void $.say($.whisperPrefix(a)+$.adminMsg);if(t.equalsIgnoreCase("submessage"))return $.isAdmin(a)?0==u.length?void $.say($.whisperPrefix(a)+$.lang.get("subscribehandler.sub.msg.usage")):($.inidb.set("subscribeHandler","subscribeMessage",d),s=d+"",$.say($.whisperPrefix(a)+$.lang.get("subscribehandler.sub.msg.set")),void $.logEvent("subscribehandler.js",131,a+' changed the subscriber message to "'+s+'"')):void $.say($.whisperPrefix(a)+$.adminMsg);if(t.equalsIgnoreCase("resubmessage"))return $.isAdmin(a)?0==u.length?void $.say($.whisperPrefix(a)+$.lang.get("subscribehandler.resub.msg.usage")):($.inidb.set("subscribeHandler","reSubscribeMessage",d),r=d+"",$.say($.whisperPrefix(a)+$.lang.get("subscribehandler.resub.msg.set")),void $.logEvent("subscribehandler.js",149,a+' changed the re-subscriber message to "'+r+'"')):void $.say($.whisperPrefix(a)+$.adminMsg);if(t.equalsIgnoreCase("subscribereward"))return $.isAdmin(a)?0==u.length?void $.say($.whisperPrefix(a)+$.lang.get("subscribehandler.reward.usage")):($.inidb.set("subscribeHandler","subscribeReward",parseInt(u[0])),n=parseInt(u[0]),$.say($.whisperPrefix(a)+$.lang.get("subscribehandler.reward.set")),void $.logEvent("subscribehandler.js",204,a+" changed the subscriber reward to "+n)):void $.say($.whisperPrefix(a)+$.adminMsg);if(t.equalsIgnoreCase("subscribercount")){if(!$.isAdmin(a))return void $.say($.whisperPrefix(a)+$.adminMsg);var l,g=$.inidb.GetKeyList("subscribed",""),o=0;for(l=0;l<g.length;l++)o++;$.say($.whisperPrefix(a)+$.lang.get("subscribehandler.sub.count",o))}if(t.equalsIgnoreCase("subscribers")){if(!$.isModv3(a,b.getTags()))return void $.say($.whisperPrefix(a)+$.modMsg);$.say(".subscribers"),$.logEvent("subscribehandler.js",236,a+" enabled subscriber only mode")}if(t.equalsIgnoreCase("subscribersoff")){if(!$.isModv3(a,b.getTags()))return void $.say($.whisperPrefix(a)+$.modMsg);$.say(".subscribersoff"),$.logEvent("subscribehandler.js",236,a+" disabled subscriber only mode")}}),$.bind("ircPrivateMessage",function(e){var a,t,d=e.getSender(),u=e.getMessage(),l=u.substring(0,u.indexOf(" ",1)).toString();if(a=s+"",t=r+"",d.equalsIgnoreCase("twitchnotify")){if(i&&u.contains("just subscribed!"))return a=a.replace(/\(name\)/gi,l),a=a.replace(/\(reward\)/gi,n.toString()),$.say(a),$.addSubUsersList(l),$.restoreSubscriberStatus(l,!0),void $.logEvent("subscribehandler.js",248,l+" subscribed.");if(b&&u.contains("months in a row!")&&u.contains("subscribed for")){var g=u.substring(u.indexOf("months")-3,u.indexOf("months")-1).toString();t=t.replace(/\(name\)/gi,l),t=t.replace(/\(months\)/gi,g),t=t.replace(/\(reward\)/gi,n.toString()),$.say(t),$.logEvent("subscribehandler.js",258,l+" re-subscribed for "+g+" months.")}}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./handlers/subscribehandler.js")&&($.registerChatCommand("./handlers/subscribehandler.js","subwelcometoggle",2),$.registerChatCommand("./handlers/subscribehandler.js","resubwelcometoggle",2),$.registerChatCommand("./handlers/subscribehandler.js","subscribereward",2),$.registerChatCommand("./handlers/subscribehandler.js","subscribercount",2),$.registerChatCommand("./handlers/subscribehandler.js","submessage",2),$.registerChatCommand("./handlers/subscribehandler.js","resubmessage",2),$.registerChatCommand("./handlers/subscribehandler.js","subscribers",2),$.registerChatCommand("./handlers/subscribehandler.js","subscribersoff",2),$.registerChatCommand("./handlers/subscribehandler.js","subscribepanelupdate",1))})}();
