!function(){function e(){a=$.getIniDbString("gameWispSubHandler","subscribeMessage"),n=$.getIniDbString("gameWispSubHandler","reSubscribeMessage"),t=$.getIniDbString("gameWispSubHandler","tierUpMessage"),subShowMessages=$.getIniDbBoolean("gameWispSubHandler","subscriberShowMessages"),subReward=$.getIniDbNumber("gameWispSubHandler","subscribeReward"),reSubReward=$.getIniDbNumber("gameWispSubHandler","reSubscribeReward"),g.songrequests[1]=$.getIniDbNumber("gameWispTiers","songrequest_1"),g.songrequests[2]=$.getIniDbNumber("gameWispTiers","songrequest_2"),g.songrequests[3]=$.getIniDbNumber("gameWispTiers","songrequest_3"),g.songrequests[4]=$.getIniDbNumber("gameWispTiers","songrequest_4"),g.songrequests[5]=$.getIniDbNumber("gameWispTiers","songrequest_5"),g.songrequests[6]=$.getIniDbNumber("gameWispTiers","songrequest_6"),g.bonuspoints[1]=$.getIniDbNumber("gameWispTiers","bonuspoints_1"),g.bonuspoints[2]=$.getIniDbNumber("gameWispTiers","bonuspoints_2"),g.bonuspoints[3]=$.getIniDbNumber("gameWispTiers","bonuspoints_3"),g.bonuspoints[4]=$.getIniDbNumber("gameWispTiers","bonuspoints_4"),g.bonuspoints[5]=$.getIniDbNumber("gameWispTiers","bonuspoints_5"),g.bonuspoints[6]=$.getIniDbNumber("gameWispTiers","bonuspoints_6"),g.subbonuspoints[1]=$.getIniDbNumber("gameWispTiers","subbonuspoints_1"),g.subbonuspoints[2]=$.getIniDbNumber("gameWispTiers","subbonuspoints_2"),g.subbonuspoints[3]=$.getIniDbNumber("gameWispTiers","subbonuspoints_3"),g.subbonuspoints[4]=$.getIniDbNumber("gameWispTiers","subbonuspoints_4"),g.subbonuspoints[5]=$.getIniDbNumber("gameWispTiers","subbonuspoints_5"),g.subbonuspoints[6]=$.getIniDbNumber("gameWispTiers","subbonuspoints_6")}function s(e){if($.bot.isModuleEnabled("./handlers/gameWispHandler.js")){$.consoleDebug("checkGameWispSub("+e+")");var s=$.gamewisp.getUserSubInfoString(e)+"",r=JSON.parse(s);return $.consoleDebug("checkGameWispSub("+e+"): "+s),1!=r.result.status?($.consoleDebug("checkGameWispSub("+e+"): status != 1"),void($.getIniDbBoolean("gamewispsubs",e,!1)&&$.addGWSubUsersList($.users[i][0],$.getIniDbNumber("gamewispsubs",e+"_tier",1)))):void 0==r.data[0]?($.consoleDebug("checkGameWispSub("+e+"): data is undefined"),void($.getIniDbBoolean("gamewispsubs",e,!1)&&$.addGWSubUsersList($.users[i][0],$.getIniDbNumber("gamewispsubs",e+"_tier",1)))):void 0==r.data[0].status?($.consoleDebug("checkGameWispSub("+e+"): status is undefined"),void($.getIniDbBoolean("gamewispsubs",e,!1)&&$.addGWSubUsersList($.users[i][0],$.getIniDbNumber("gamewispsubs",e+"_tier",1)))):void(r.data[0].status.equals("inactive")?($.consoleDebug("checkGameWispSub("+e+"): inactive account"),$.delGWSubUsersList(e),$.restoreSubscriberStatus(e,!1)):($.consoleDebug("checkGameWispSub("+e+"): adding to sub users list"),$.addGWSubUsersList(e,parseInt(r.data[0].tier.data.level)),$.consoleDebug("checkGameWispSub("+e+"): calling DB update; mods are ignored"),$.restoreSubscriberStatus(e,!1),$.consoleDebug("checkGameWispSub("+e+"): handler complete")))}}function r(e,s){var i=$.getGWTier(e.toLowerCase());return g[s][i]}var a=$.getSetIniDbString("gameWispSubHandler","subscribeMessage","(name) just subscribed via GameWisp at tier level (tier)!"),n=$.getSetIniDbString("gameWispSubHandler","reSubscribeMessage","(name) just subscribed for (months) months in a row via GameWisp!"),t=$.getSetIniDbString("gameWispSubHandler","tierUpMessage","(name) upgraded to tier (tier) on GameWisp!");subShowMessages=$.getSetIniDbBoolean("gameWispSubHandler","subscriberShowMessages",!0),subReward=$.getSetIniDbNumber("gameWispSubHandler","subscribeReward",0),reSubReward=$.getSetIniDbNumber("gameWispSubHandler","reSubscribeReward",0);var g=[];g.songrequests=[],g.songrequests[0]=0,g.songrequests[1]=$.getSetIniDbNumber("gameWispTiers","songrequest_1",0),g.songrequests[2]=$.getSetIniDbNumber("gameWispTiers","songrequest_2",0),g.songrequests[3]=$.getSetIniDbNumber("gameWispTiers","songrequest_3",0),g.songrequests[4]=$.getSetIniDbNumber("gameWispTiers","songrequest_4",0),g.songrequests[5]=$.getSetIniDbNumber("gameWispTiers","songrequest_5",0),g.songrequests[6]=$.getSetIniDbNumber("gameWispTiers","songrequest_6",0),g.bonuspoints=[],g.bonuspoints[0]=0,g.bonuspoints[1]=$.getSetIniDbNumber("gameWispTiers","bonuspoints_1",0),g.bonuspoints[2]=$.getSetIniDbNumber("gameWispTiers","bonuspoints_2",0),g.bonuspoints[3]=$.getSetIniDbNumber("gameWispTiers","bonuspoints_3",0),g.bonuspoints[4]=$.getSetIniDbNumber("gameWispTiers","bonuspoints_4",0),g.bonuspoints[5]=$.getSetIniDbNumber("gameWispTiers","bonuspoints_5",0),g.bonuspoints[6]=$.getSetIniDbNumber("gameWispTiers","bonuspoints_6",0),g.subbonuspoints=[],g.subbonuspoints[0]=0,g.subbonuspoints[1]=$.getSetIniDbNumber("gameWispTiers","subbonuspoints_1",0),g.subbonuspoints[2]=$.getSetIniDbNumber("gameWispTiers","subbonuspoints_2",0),g.subbonuspoints[3]=$.getSetIniDbNumber("gameWispTiers","subbonuspoints_3",0),g.subbonuspoints[4]=$.getSetIniDbNumber("gameWispTiers","subbonuspoints_4",0),g.subbonuspoints[5]=$.getSetIniDbNumber("gameWispTiers","subbonuspoints_5",0),g.subbonuspoints[6]=$.getSetIniDbNumber("gameWispTiers","subbonuspoints_6",0),$.bind("gameWispChange",function(e){if($.bot.isModuleEnabled("./handlers/gameWispHandler.js")){var s=e.getUsername().toLowerCase(),i=e.getStatus();i.equals("inactive")&&($.delGWSubUsersList(s),$.restoreSubscriberStatus(s,!1))}}),$.bind("gameWispBenefits",function(e){if($.bot.isModuleEnabled("./handlers/gameWispHandler.js")){var s=e.getUsername().toLowerCase(),i=$.resolveRank(s),r=parseInt(e.getTier());r>$.getGWTier(s)&&($.addGWSubUsersList(s,r),subShowMessages&&$.say(t.replace("(name)",i).replace("(tier)",r)))}}),$.bind("gameWispSubscribe",function(e){if($.bot.isModuleEnabled("./handlers/gameWispHandler.js")){var s=e.getUsername().toLowerCase(),i=$.resolveRank(s),r=parseInt(e.getTier()),n=subReward+g.subbonuspoints[r];$.addGWSubUsersList(s,r),$.restoreSubscriberStatus(s,!1),subShowMessages&&($.inidb.incr("points",s,n),$.say(a.replace("(name)",i).replace("(tier)",r.toString()).replace("(reward)",n.toString())))}}),$.bind("gameWispAnniversary",function(e){if($.bot.isModuleEnabled("./handlers/gameWispHandler.js")){var s=e.getUsername().toLowerCase(),i=$.resolveRank(s),r=parseInt(e.getMonths()),a=$.getGWTier(s),t=subReward+g.subbonuspoints[a];subShowMessages&&($.inidb.incr("points",s,parseInt(t)),$.say(n.replace("(name)",i).replace("(tier)",a.toString()).replace("(reward)",t.toString()).replace("(months)",r.toString())))}}),$.bind("command",function(s){var i=s.getCommand(),r=s.getSender().toLowerCase(),u=s.getArgs();if(i.equalsIgnoreCase("gamewisppanelupdate")&&e(),i.equalsIgnoreCase("gamewisp")){var b=["submessage","resubmessage","togglemessage","reward","resubreward"];if(!u[0])return void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.usage",b.join(" | ")));if(u[0].equalsIgnoreCase("submessage"))return u.length<2?void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.submessage.usage",a)):(a=u.splice(1).join(" "),$.inidb.set("gameWispSubHandler","subscribeMessage",a),void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.submessage.success",a)));if(u[0].equalsIgnoreCase("resubmessage"))return u.length<2?void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.resubmessage.usage",n)):(n=u.splice(1).join(" "),$.inidb.set("gameWispSubHandler","reSubscribeMessage",n),void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.resubmessage.success",n)));if(u[0].equalsIgnoreCase("tierupmessage"))return u.length<2?void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.tierupmessage.usage",t)):(t=u.splice(1).join(" "),$.inidb.set("gameWispSubHandler","tierUpMessage",tierUpessage),void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.tierupmessage.success",t)));if(u[0].equalsIgnoreCase("togglemessage")){if(u.length<2)return void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.togglemessage.usage",subShowMessages));if(u[1].equalsIgnoreCase("on"))$.setIniDbBoolean("gameWispSubHandler","subscriberShowMessages",!0);else{if(!u[1].equalsIgnoreCase("off"))return void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.togglemessage.usage",subShowMessages));$.setIniDbBoolean("gameWispSubHandler","subscriberShowMessages",!1)}return void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.togglemessage.success",subShowMessages))}if(u[0].equalsIgnoreCase("reward"))return u.length<2?void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.reward.usage",subReward)):isNaN(u[1])?void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.reward.usage",subReward)):(subReward=parseInt(u[1]),void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.reward.success",subReward)));if(u[0].equalsIgnoreCase("resubreward"))return u.length<2?void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.resubreward.usage",reSubReward)):isNaN(u[1])?void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.resubreward.usage",reSubReward)):(reSubReward=parseInt(u[1]),void $.say($.whisperPrefix(r)+$.lang.get("gamewisp.resubreward.success",reSubReward)))}if(i.equalsIgnoreCase("gamewisptier")){var o=0,p=0,m=0,d=["songrequests","bonuspoints","subbonuspoints"];if(!u[0])return void $.say($.whisperPrefix(r)+$.lang.get("gamewisptier.usage",d.join(" | ")));if(-1!==d.indexOf(u[0]+""))return u.length<2?void $.say($.whisperPrefix(r)+$.lang.get("gamewisptier."+u[0]+".usage")):(o=parseInt(u[1]),isNaN(o)||1>o||o>6?void $.say($.whisperPrefix(r)+$.lang.get("gamewisptier."+u[0]+".usage")):(m=g[u[0]][o],u.length<3?void $.say($.whisperPrefix(r)+$.lang.get("gamewisptier."+u[0]+".usage.tier",o,m)):(p=parseInt(u[2]),isNaN(p)||1>p?void $.say($.whisperPrefix(r)+$.lang.get("gamewisptier."+u[0]+"usage.tier",o,m)):(g[u[0]][o]=p,$.inidb.set("gameWispTiers",u[0]+"_"+o,p),void $.say($.whisperPrefix(r)+$.lang.get("gamewisptier."+u[0]+".success",o,m,p))))))}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./handlers/gameWispHandler.js")&&($.registerChatCommand("./handlers/gameWispHandler.js","gamewisp",1),$.registerChatCommand("./handlers/gameWispHandler.js","gamewisptier",1),$.registerChatCommand("./handlers/gameWispHandler.js","gamewisppanelupdate",1))}),$.getTierData=r,$.checkGameWispSub=s}();
