!function(){function n(){e=$.getIniDbBoolean("donations","announce"),a=$.getIniDbFloat("donations","reward"),o=$.getIniDbString("donations","message"),t=$.getIniDbString("donations","lastmessage")}var e=$.getSetIniDbBoolean("donations","announce",!0),a=$.getSetIniDbFloat("donations","reward",0),o=$.getSetIniDbString("donations","message",$.lang.get("donationhandler.donation.new")),t=$.getSetIniDbString("donations","lastmessage",$.lang.get("donationhandler.lastdonation.success")),i="./addons/donationHandler";$.bind("twitchAlertsDonationInitialized",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.isDirectory(i)||($.consoleLn(">> Creating Donation Handler Directory: "+i),$.mkDir(i)),$.consoleLn(">> Enabling Twitch Alerts donation announcements"),$.logEvent("donationHandler.js",25,"Donation announcements enabled"),e=!0)}),$.bind("twitchAlertsDonation",function(n){if($.bot.isModuleEnabled("./handlers/donationHandler.js")){var t=n.getJsonString(),s=Packages.org.json.JSONObject,d=new s(t),r=d.getString("donation_id"),l=(d.getString("created_at"),d.getString("currency")),g=parseFloat(d.getString("amount")),c=d.getString("name"),u=d.getString("message");if(!$.inidb.exists("donations",r)){if($.inidb.set("donations",r,d),$.inidb.set("donations","last_donation",r),$.writeToFile(c+": "+g.toFixed(2),i+"/latestDonation.txt",!1),e){var m=Math.round(g*a),h=o;h=h.replace("(name)",c),h=h.replace("(amount)",g.toFixed(2)),h=h.replace("(points)",m.toString()),h=h.replace("(pointname)",(1==m?$.pointNameSingle:$.pointNameMultiple).toLowerCase()),h=h.replace("(currency)",l),h=h.replace("(message)",u),$.say(h)}$.inidb.exists("points",c.toLowerCase())&&m>0&&$.inidb.incr("points",c.toLowerCase(),m)}}}),$.bind("command",function(o){var i=o.getSender().toLowerCase(),s=o.getCommand(),d=o.getArgs();if(s.equalsIgnoreCase("donationpanelupdate")&&n(),s.equalsIgnoreCase("lastdonation")){if(!$.inidb.exists("donations","last_donation"))return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.lastdonation.no-donations"));var r=$.inidb.get("donations","last_donation");if(!$.inidb.exists("donations",r))return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.lastdonation.404"));var l=$.inidb.get("donations",r),g=Packages.org.json.JSONObject,c=new g(l),r=c.getString("donation_id"),u=(c.getString("created_at"),c.getString("currency")),m=parseFloat(c.getString("amount")),h=c.getString("name"),b=(c.getString("message"),t);b=b.replace("(name)",h),b=b.replace("(amount)",m.toFixed(2)),b=b.replace("(currency)",u),$.say(b)}if(s.equalsIgnoreCase("donations")){if(!d[0])return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.usage"));if(d[0].equalsIgnoreCase("announce"))return void(e?($.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.announce.disable")),e=!1,$.inidb.set("donations","announce","false"),$.logEvent("donationHandler.js",140,i+" disabled donation announcements")):($.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.announce.enable")),e=!0,$.inidb.set("donations","announce","true"),$.logEvent("donationHandler.js",145,i+" enabled donation announcements")));if(d[0].equalsIgnoreCase("rewardmultiplier"))return d[1]?isNaN(d[1])?void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.reward.usage")):($.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.reward.success",d[1],("1"==d[1]?$.pointNameSingle:$.pointNameMultiple).toLowerCase())),$.inidb.set("donations","reward",d[1]),a=parseFloat(d[1]),void $.logEvent("donationHandler.js",166,i+" changed donation reward to "+d[1])):void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations.reward.usage"));if(d[0].equalsIgnoreCase("message")||d[0].equalsIgnoreCase("lastmessage")){var p=d[0].toLowerCase();if(!d[1])return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations."+p+".usage"));var w=d.splice(1).join(" ");if(-1==w.search(/\(name\)/))return void $.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations."+p+".no-name"));$.inidb.set("donations",p,w),$.say($.whisperPrefix(i)+$.lang.get("donationhandler.donations."+p+".success",w)),$.logEvent("donationHandler.js",191,i+" set the donation message to "+w)}}}),$.bind("initReady",function(){$.bot.isModuleEnabled("./handlers/donationHandler.js")&&($.registerChatCommand("./handlers/donationHandler.js","lastdonation",7),$.registerChatCommand("./handlers/donationHandler.js","donations",1),$.registerChatCommand("./handlers/donationHandler.js","donationpanelupdate",1))})}();
